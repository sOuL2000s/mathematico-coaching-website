<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATHEMATICO - Special Mathematics Coaching</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Favicon for the website -->
    <link rel="icon" href="sigma.png" type="image/png">
    <style>
        /* Custom styles for the Inter font */
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden; /* Ensure no horizontal scrolling on the body */
            background-color: #f8fafc; /* Lighter background for overall aesthetic */
        }
        html {
            overflow-x: hidden; /* Ensure no horizontal scrolling on the html element either */
            scroll-behavior: smooth;
        }
        /* Keyframe animation for fade-in-up effect */
        @keyframes fadeInUpp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInUpp 0.8s ease-out forwards;
        }
        .animate-fade-in-up.delay-200 {
            animation-delay: 0.2s;
        }
        /* For sticky header and anchor links */
        section {
            scroll-margin-top: 80px; /* Adjust this value based on your header's height */
        }

        /* Styles for the hamburger menu */
        .hamburger-menu {
            display: none; /* Hidden by default, shown on small screens */
        }
        @media (max-width: 767px) {
            .hamburger-menu {
                display: block;
            }
            .navbar-links {
                flex-direction: column;
                background-color: white; /* Default light mode background */
                position: absolute;
                top: 80px; /* Position directly below the header, assuming header height is 80px */
                left: 0; /* Align to the left edge of the viewport */
                width: 100vw; /* Span the full viewport width */
                padding: 1rem 0; /* Vertical padding */
                box-shadow: 0 8px 16px rgba(0,0,0,0.1);
                border-radius: 0 0 0.5rem 0.5rem;
                z-index: 60; /* Higher than sticky header */
                overflow: hidden; /* Hide overflow initially */
                box-sizing: border-box; /* Include padding in the element's total width/height */
                transition: max-height 0.3s ease-out, opacity 0.3s ease-out; /* Smooth transition for height and opacity */

                /* Default hidden state for mobile */
                display: none; /* Explicitly hide it */
                opacity: 0; /* For opacity transition */
                max-height: 0; /* For height transition */

                /* Dark mode styles for the mobile menu */
                .dark & { /* Apply these styles when html has 'dark' class */
                    background-color: #1f2937; /* dark-gray-800 */
                }
            }
            .navbar-links.active {
                display: flex; /* Show as flex when active */
                max-height: 500px; /* Max height for the menu when active (adjust as needed) */
                opacity: 1; /* Fully visible */
                overflow-y: auto; /* Enable scrolling if content exceeds max-height */
            }
            .navbar-links li {
                width: 100%;
                text-align: center;
            }
            .navbar-links a {
                display: block;
                padding: 0.75rem 1rem; /* Consistent padding for links */
                color: #4b5563; /* Default light mode text color */
                /* Dark mode styles for menu links */
                .dark & { /* Apply these styles when html has 'dark' class */
                    color: #d1d5db; /* dark-gray-300 */
                }
            }
        }

        /* Accordion styles */
        .accordion-header {
            cursor: pointer;
            padding: 1.25rem;
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0.75rem; /* Added rounded corners */
            transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .accordion-header:hover {
            background-color: #f3f4f6; /* Light hover effect */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Subtle shadow on hover */
        }
        .dark .accordion-header:hover {
            background-color: #374151; /* Dark hover effect */
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            padding: 0 1.25rem;
        }
        .accordion-content.active {
            max-height: 200px; /* Adjust as needed for content */
            padding: 1rem 1.25rem;
        }
        /* Style for scroll-to-top button */
        #scroll-to-top {
            display: none; /* Hidden by default */
            position: fixed;
            bottom: 1.5rem;
            right: 6rem; /* Adjusted right position to prevent overlap with WhatsApp CTA */
            z-index: 90; /* Lower z-index than WhatsApp CTA */
            background-color: #4f46e5; /* Indigo-600 */
            color: white;
            padding: 0.75rem;
            border-radius: 9999px; /* Full rounded */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease-in-out, transform 0.2s ease-in-out;
        }
        #scroll-to-top:hover {
            background-color: #4338ca; /* Indigo-700 */
            transform: scale(1.1);
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px; /* Increased max-width for iframe */
            height: 80%; /* Set a height for the iframe */
            max-height: 90vh; /* Limit height for scrollability */
            transform: translateY(20px);
            transition: transform 0.3s ease-in-out;
            position: relative;
            overflow: hidden; /* Hide overflow for the modal content itself */
        }
        .modal.active .modal-content {
            transform: translateY(0);
        }
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4b5563;
        }
        .dark .modal-content {
            background-color: #1f2937; /* dark-gray-800 */
            color: #d1d5db;
        }
        .dark .modal-close-button {
            color: #d1d5db;
        }
        .modal-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* WhatsApp CTA Z-index */
        .whatsapp-cta {
            z-index: 95; /* Higher z-index than scroll-to-top */
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s ease infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Admin Mode Indicator */
        .admin-indicator {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ef4444; /* Red-500 */
            color: white;
            padding: 0.5rem 1rem;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            font-weight: bold;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none; /* Hidden by default */
        }
        .admin-indicator.active {
            display: block;
        }

        /* Dropdown specific styles for Navbar */
        .dropdown-menu {
            visibility: hidden; /* Changed from display: none; */
            opacity: 0; /* Changed from display: none; */
            pointer-events: none; /* Prevents interaction when hidden */
            position: absolute;
            background-color: white; /* Default light mode */
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 70; /* Higher than navbar-links on mobile, but lower than main modals */
            border-radius: 0.5rem;
            overflow: hidden;
            top: calc(100% + 0.5rem); /* Position below the parent link */
            left: 50%;
            transform: translateX(-50%);
            transition: opacity 0.3s ease-out, visibility 0.3s ease-out; /* Smooth transition */

            /* Dark mode styles for dropdown */
            .dark & {
                background-color: #1f2937;
            }
        }

        .dropdown:hover .dropdown-menu,
        .dropdown.active .dropdown-menu { /* .active for mobile toggle */
            visibility: visible; /* Changed from display: block; */
            opacity: 1; /* Changed from display: block; */
            pointer-events: auto; /* Allows interaction when visible */
        }

        .dropdown-menu a {
            color: #4b5563; /* Default light mode */
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
            transition: background-color 0.2s ease-in-out;
        }

        .dropdown-menu a:hover {
            background-color: #f3f4f6; /* Light gray hover */
        }

        /* Dark mode for dropdown links */
        .dark .dropdown-menu a {
            color: #d1d5db;
        }
        .dark .dropdown-menu a:hover {
            background-color: #374151; /* Darker gray hover */
        }

        /* Mobile dropdown specific adjustments */
        @media (max-width: 767px) {
            .navbar-links .dropdown-menu {
                position: static; /* Allow it to flow naturally in the column layout */
                transform: none;
                box-shadow: none;
                border-radius: 0;
                min-width: unset;
                width: 100%; /* Take full width of parent li */
                padding: 0; /* Remove padding, links handle it */
                max-height: 0; /* Control visibility with max-height */
                opacity: 0;
                visibility: hidden;
                transition: max-height 0.3s ease-out, opacity 0.3s ease-out, visibility 0.3s ease-in-out;
            }

            .navbar-links .dropdown.active .dropdown-menu {
                max-height: 300px; /* Adjust as needed */
                opacity: 1;
                visibility: visible;
            }

            .navbar-links .dropdown-menu a {
                padding-left: 2.5rem; /* Indent dropdown items */
            }
        }

        /* Blog Detail Modal specific styles */
        #blog-detail-modal .modal-content {
            max-width: 800px; /* Larger for blog content */
            height: 90%; /* Allow more height */
            overflow-y: auto; /* Enable scrolling for long content */
        }
        #blog-detail-modal img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        #blog-detail-modal p {
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        /* Gallery Image Modal specific styles */
        #gallery-image-modal .modal-content {
            max-width: 90%; /* Allow wider images */
            max-height: 90vh; /* Limit height to viewport */
            width: auto; /* Adjust width based on image */
            height: auto; /* Adjust height based on image */
            padding: 1rem; /* Smaller padding for image modal */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #gallery-image-modal img {
            max-width: 100%;
            max-height: 80vh; /* Max height for the image itself */
            object-fit: contain; /* Ensure image fits without cropping */
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        #gallery-image-modal .modal-caption {
            color: #4b5563; /* Default light mode */
            font-size: 0.9rem;
            text-align: center;
            padding: 0.5rem;
            word-wrap: break-word; /* Ensure long captions wrap */
            max-width: 100%;
        }
        .dark #gallery-image-modal .modal-caption {
            color: #d1d5db; /* Dark mode */
        }

        /* Custom card styles for sections like Courses, Features, Testimonials, Success Stories */
        .card {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); /* Softer, larger shadow */
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 1px solid #e0e7ff; /* Light indigo border */
        }
        .card:hover {
            transform: translateY(-8px) scale(1.02); /* Lift and slightly enlarge on hover */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15); /* More pronounced shadow on hover */
            border-color: #818cf8; /* Darker indigo border on hover */
        }
        .dark .card {
            background-color: #1f2937; /* Dark mode background */
            border-color: #374151; /* Dark mode border */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .dark .card:hover {
            border-color: #6366f1; /* Darker indigo border on hover in dark mode */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        /* Icon styling within cards */
        .card svg {
            color: #4f46e5; /* Indigo-600 */
            margin-bottom: 1rem;
            width: 3rem; /* Larger icons */
            height: 3rem;
            transition: transform 0.3s ease-in-out;
        }
        .card:hover svg {
            transform: scale(1.1); /* Icon slightly scales on card hover */
        }
        .dark .card svg {
            color: #818cf8; /* Lighter indigo for dark mode */
        }

        /* Button styling */
        .btn-primary {
            background-image: linear-gradient(to right, #6366f1, #8b5cf6); /* Gradient background */
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px; /* Pill shape */
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); /* Shadow matching gradient */
            transition: all 0.3s ease-in-out;
            border: none; /* Remove default border */
        }
        .btn-primary:hover {
            transform: translateY(-2px); /* Slight lift */
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6); /* More pronounced shadow */
            background-image: linear-gradient(to left, #6366f1, #8b5cf6); /* Reverse gradient on hover */
        }
        .btn-secondary {
            background-color: transparent;
            border: 2px solid #6366f1;
            color: #6366f1;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: all 0.3s ease-in-out;
        }
        .btn-secondary:hover {
            background-color: #6366f1;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        .dark .btn-secondary {
            border-color: #818cf8;
            color: #818cf8;
        }
        .dark .btn-secondary:hover {
            background-color: #818cf8;
            color: #1f2937;
        }

        /* Input and textarea styling */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="url"],
        input[type="file"],
        textarea,
        select {
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db; /* Light gray border */
            background-color: #f9fafb; /* Off-white background */
            transition: all 0.2s ease-in-out;
        }
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="url"]:focus,
        input[type="file"]:focus,
        textarea:focus,
        select:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); /* Focus ring */
            background-color: white;
        }
        .dark input[type="text"],
        .dark input[type="email"],
        .dark input[type="password"],
        .dark input[type="url"],
        .dark input[type="file"],
        .dark textarea,
        .dark select {
            background-color: #374151; /* Darker background */
            border-color: #4b5563; /* Darker border */
            color: #d1d5db;
        }
        .dark input[type="text"]:focus,
        .dark input[type="email"]:focus,
        .dark input[type="password"]:focus,
        .dark input[type="url"]:focus,
        .dark input[type="file"]:focus,
        .dark textarea:focus,
        .dark select:focus {
            border-color: #818cf8;
            box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.3);
            background-color: #1f2937;
        }

        /* Specific section background patterns/gradients */
        #home {
            background-image: linear-gradient(to right top, #6366f1, #8b5cf6, #a855f7, #c14ff9, #d94ffb); /* More vibrant gradient */
            position: relative;
            overflow: hidden;
        }
        #home::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='30' cy='30' r='30'/%3E%3Cpath d='M30 0C13.431 0 0 13.431 0 30s13.431 30 30 30 30-13.431 30-30S46.569 0 30 0zm0 58C14.536 58 2 45.464 2 30S14.536 2 30 2s28 12.536 28 28-12.536 28-28 28z'/%3E%3C/g%3E%3C/svg%3E");
            background-size: 60px 60px;
            opacity: 0.1;
            z-index: 0;
        }

        /* Ensure .page-section has consistent margin and padding */
        .page-section {
            padding-top: 4rem;
            padding-bottom: 4rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
            border-radius: 1rem; /* Consistent rounded corners for sections */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05); /* Lighter shadow for sections */
        }
        .dark .page-section {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Testimonial image borders */
        .testimonial-img {
            border: 4px solid #c7d2fe; /* Light indigo */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .dark .testimonial-img {
            border-color: #4338ca; /* Darker indigo */
        }

        /* Success Story image borders */
        .success-story-img {
            border: 4px solid #d8b4fe; /* Light purple */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .dark .success-story-img {
            border-color: #7e22ce; /* Darker purple */
        }

        /* Blog and Gallery item styling */
        .blog-card, .gallery-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.07);
            transition: all 0.3s ease-in-out;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }
        .blog-card:hover, .gallery-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #a5b4fc; /* Light blueish-indigo hover border */
        }
        .dark .blog-card, .dark .gallery-card {
            background-color: #1f2937;
            border-color: #374151;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .dark .blog-card:hover, .dark .gallery-card:hover {
            border-color: #6366f1;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .blog-card img, .gallery-card img {
            object-fit: cover;
            width: 100%;
            height: 200px; /* Consistent height for images */
            border-radius: 0.75rem 0.75rem 0 0; /* Rounded top corners */
        }
        .gallery-card img {
            height: 192px; /* Adjusted for gallery to fit better */
        }

        /* Specific styling for the contact form and info cards */
        .contact-info-card {
            background-color: #f0f4f8; /* Lighter background for info cards */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            border: 1px solid #d1d5db;
        }
        .dark .contact-info-card {
            background-color: #374151;
            border-color: #4b5563;
        }
        .contact-info-card svg {
            color: #4f46e5; /* Indigo-600 */
        }
        .dark .contact-info-card svg {
            color: #818cf8;
        }

        /* Google Maps iframe styling */
        #google-maps-container iframe {
            border-radius: 1rem; /* Match section border-radius */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        .dark #google-maps-container iframe {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Admin panel styling */
        .admin-panel {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.07);
            border: 1px solid #e5e7eb;
        }
        .dark .admin-panel {
            background-color: #1f2937;
            border-color: #374151;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

    </style>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Best mathematics coaching for classes 9-12, IIT-JEE, Olympiads, and university level by Dipanjan Chatterjee.">
    <meta name="keywords" content="mathematics coaching, JEE, Olympiad, Barasat, Madhyamgram, Dipanjan Chatterjee, math tutor, Pure Maths">
    <meta name="author" content="Dipanjan Chatterjee">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.yourwebsite.com/"> <!-- Replace with your actual URL -->
    <meta property="og:title" content="MATHEMATICO - Special Mathematics Coaching by Dipanjan Chatterjee">
    <meta property="og:description" content="Comprehensive coaching for all boards, competitive exams, and higher studies by Dipanjan Chatterjee.">
    <meta property="og:image" content="https://www.yourwebsite.com/og-image.jpg"> <!-- Replace with your actual OG image -->

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.yourwebsite.com/"> <!-- Replace with your actual URL -->
    <meta property="twitter:title" content="MATHEMATICO - Special Mathematics Coaching by Dipanjan Chatterjee">
    <meta property="twitter:description" content="Comprehensive coaching for all boards, competitive exams, and higher studies by Dipanjan Chatterjee.">
    <meta property="twitter:image" content="https://www.yourwebsite.com/twitter-image.jpg"> <!-- Replace with your actual Twitter image -->

</head>
<body class="bg-gray-50 text-gray-800 transition-colors duration-300 ease-in-out">

    <!-- Admin Mode Indicator -->
    <div id="admin-mode-indicator" class="admin-indicator">
        ADMIN MODE
    </div>

    <header class="bg-white shadow-lg py-4 sticky top-0 z-50 rounded-b-lg
                   dark:bg-gray-900 dark:shadow-2xl transition-colors duration-300 ease-in-out">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center relative px-6 md:px-12">
            <div class="flex items-center justify-between w-full md:w-auto mb-4 md:mb-0">
                <!-- Added ID to the logo link for easier targeting -->
                <a href="#home" id="mathematico-logo" class="text-3xl font-extrabold text-indigo-700 flex items-center" aria-label="MATHEMATICO Home">
                   <!-- Updated SVG for MATHEMATICO logo (Sigma symbol) - Keeping original thematic icon -->
                   <svg class="w-8 h-8 mr-2 text-indigo-600" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6H6v2h12V6zm0 3H6v2h12V9zm-6 3H6v2h6v-2zm6 3H6v2h12v-2z"/>
                   </svg>
                   MATHEMATICO
                </a>
                <!-- Hamburger Menu Button -->
                <button id="hamburger-button" class="md:hidden p-2 rounded-md text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-label="Toggle navigation menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <!-- Adjusted space-x for better fit -->
            <ul id="navbar-links" class="md:flex space-x-2 md:space-x-4 text-lg font-medium">
                <li><a href="#home" class="text-gray-600 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out rounded-md px-2 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700" aria-label="Go to Home section">Home</a></li>
                <li><a href="#about" class="text-gray-600 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out rounded-md px-2 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700" aria-label="Go to About Us section">About Us</a></li>
                <!-- Courses Dropdown -->
                <li class="relative dropdown">
                    <!-- Changed href to javascript:void(0) for dropdown toggle on desktop to prevent page jump -->
                    <a href="javascript:void(0)" class="text-gray-600 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out rounded-md px-2 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700 flex items-center" aria-label="View Courses">
                        Courses
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#courses" data-course-filter="Classes 9-12 (All Boards)" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700">Classes 9-12 (All Boards)</a></li>
                        <li><a href="#courses" data-course-filter="IIT Foundation & Olympiad" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700">IIT Foundation & Olympiad</a></li>
                        <li><a href="#courses" data-course-filter="Competitive Entrance Exams" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700">Competitive Entrance Exams</a></li>
                        <li><a href="#courses" data-course-filter="B.Sc (Hons/Pass) All Universities" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700">B.Sc (Hons/Pass) All Universities</a></li>
                        <li><a href="#courses" data-course-filter="B.Tech, GATE & Other Exams" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700">B.Tech, GATE & Other Exams</a></li>
                        <li><a href="#courses" data-course-filter="General Math Support" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700">General Math Support</a></li>
                    </ul>
                </li>
                <li><a href="#features" class="text-gray-600 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out rounded-md px-2 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700" aria-label="Go to Features section">Features</a></li>

                <!-- New "More" Dropdown -->
                <li class="relative dropdown">
                    <!-- Changed href to javascript:void(0) to prevent page jump on click -->
                    <a href="javascript:void(0)" class="text-gray-600 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out rounded-md px-2 py-2 hover:bg-indigo-50 dark:hover:bg-gray-700 flex items-center" aria-label="More sections">
                        More
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#book-list-page" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Book List page">Book List</a></li>
                        <li><a href="#problems-page" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Problems page">Problems</a></li>
                        <li><a href="#gallery-page" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Gallery page">Gallery</a></li>
                        <li><a href="#testimonials" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Testimonials section">Testimonials</a></li>
                        <li><a href="#success-stories" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Success Stories section">Success Stories</a></li>
                        <li><a href="#faq" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to FAQ section">FAQ</a></li>
                        <li><a href="#blog-page" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Blog section">Blog</a></li>
                        <li><a href="#contact" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Contact section">Contact</a></li>
                        <li><a href="#links" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Useful Links section">Links</a></li>
                        <li><a href="#admin-page" class="block px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 dark:text-gray-300 dark:hover:bg-gray-700" aria-label="Go to Admin section">Admin</a></li>
                    </ul>
                </li>
                <li>
                    <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300
                                         dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600 transition-colors duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-500" aria-label="Toggle theme">
                        <svg id="sun-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h1M3 12H2m8.003-9.997l-.707.707M16.997 16.997l.707.707M3.707 3.707l-.707.707m16.586 16.586l-.707-.707M12 7a5 5 0 100 10 5 5 0 000-10z"></path>
                        </svg>
                        <svg id="moon-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 118.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                </li>
            </ul>
        </div>
    </header>

    <main id="main-content-container">
        <!-- Home Section -->
        <section id="home" class="page-section relative bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-20 md:py-32 overflow-hidden rounded-b-lg shadow-xl">
            <!-- Background pattern moved to CSS for better control and reusability -->
            <div class="container mx-auto text-center relative z-10 px-4">
                <h1 class="text-4xl md:text-6xl font-extrabold leading-tight mb-6 animate-fade-in-up">
                    Special Mathematics Coaching by <br> Dipanjan Chatterjee <br> @ MATHEMATICO
                </h1>
                <p class="text-lg md:text-xl mb-10 max-w-3xl mx-auto opacity-90 animate-fade-in-up delay-200">
                    Comprehensive coaching for all boards, competitive exams, and higher studies.
                </p>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="#courses" class="btn-primary" aria-label="Explore our courses">
                        Start Learning Today
                    </a>
                    <a href="#testimonials" class="btn-secondary" aria-label="View student testimonials">
                        See Student Results
                    </a>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="page-section py-16 md:py-24 bg-white rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                      dark:bg-gray-800 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 flex flex-col md:flex-row items-center gap-10">
                <div class="md:w-1/2">
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-6 dark:text-gray-100 transition-colors duration-300 ease-in-out">About Dipanjan Chatterjee, M.Sc in Pure Maths</h2>
                    <p class="text-lg text-gray-700 leading-relaxed mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                        At MATHEMATICO, we believe that every student has the potential to excel in mathematics. Our mission is to provide clear, concise, and engaging instruction that builds a strong foundation and fosters a deep understanding of mathematical concepts.
                    </p>
                    <p class="text-lg text-gray-700 leading-relaxed dark:text-gray-300 transition-colors duration-300 ease-in-out">
                        Led by Dipanjan Chatterjee, M.Sc in Pure Maths, our coaching center utilizes innovative teaching methods, personalized attention, and a supportive learning environment to help students overcome challenges and achieve their academic goals. We focus on conceptual clarity, problem-solving skills, and rigorous exam preparation.
                    </p>
                </div>
                <div class="md:w-1/2 flex justify-center">
                    <img src="ChatGPT Image Jul 8, 2025, 12_30_33 PM.png" alt="Portrait of Dipanjan Chatterjee, M.Sc in Pure Maths" class="rounded-xl shadow-2xl transform hover:scale-105 transition duration-500 ease-in-out w-full md:w-3/4 lg:w-2/3 h-auto object-cover" loading="lazy">
                </div>
            </div>
        </section>

        <!-- Courses Section -->
        <section id="courses" class="page-section py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Our Comprehensive Courses</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card" data-course-category="Classes 9-12 (All Boards)">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: BookOpen -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">Classes 9-12 (All Boards)</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Comprehensive coaching for students from class 9 to 12, covering all major educational boards. Strong foundation and advanced concepts.
                        </p>
                        <button class="btn-primary mt-auto enroll-button" data-course="Classes 9-12 (All Boards)" aria-label="Enroll in Classes 9-12 course">Enroll Now</button>
                    </div>

                    <div class="card" data-course-category="IIT Foundation & Olympiad">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: Award -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-award"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.89"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">IIT Foundation & Olympiad</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Specialized programs for IIT Foundation and various Mathematics Olympiads, including IOQM, RMO (Regional Maths Olympiad), building competitive skills from an early age.
                        </p>
                        <button class="btn-primary mt-auto enroll-button" data-course="IIT Foundation & Olympiad" aria-label="Enroll in IIT Foundation & Olympiad course">Enroll Now</button>
                    </div>

                    <div class="card" data-course-category="Competitive Entrance Exams">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: TrendingUp -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">Competitive Entrance Exams</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Targeted preparation for JEE (Mains/Advanced), WBJEE, ISI B-Stat/B-Math Entrance, and other engineering/statistics entrances.
                        </p>
                        <button class="btn-primary mt-auto enroll-button" data-course="Competitive Entrance Exams" aria-label="Enroll in Competitive Entrance Exams course">Enroll Now</button>
                    </div>

                    <div class="card" data-course-category="B.Sc (Hons/Pass) All Universities">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: University -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-university"><path d="M22 10a2 2 0 0 0-2-2h-2V7a3 3 0 0 0-3-3H9a3 3 0 0 0-3 3v1H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2Z"/><path d="M6 18v-4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v4"/><path d="M12 4v2"/><path d="M12 12v6"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">B.Sc (Hons/Pass) All Universities</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Support for B.Sc (Honours/Pass) mathematics students across all university syllabi, focusing on core concepts and advanced topics.
                        </p>
                        <button class="btn-primary mt-auto enroll-button" data-course="B.Sc (Hons/Pass) All Universities" aria-label="Enroll in B.Sc course">Enroll Now</button>
                    </div>

                    <div class="card" data-course-category="B.Tech, GATE & Other Exams">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: Cpu -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cpu"><rect width="16" height="16" x="4" y="4" rx="2"/><rect width="6" height="6" x="9" y="9" rx="1"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 9h2"/><path d="M2 15h2"/><path d="M20 9h2"/><path d="M20 15h2"/><path d="M9 2v2"/><path d="M9 20v2"/><path d="M18 18v2h2"/><path d="M18 4v-2h2"/><path d="M4 18v2H2"/><path d="M4 4V2H2"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">B.Tech, GATE & Other Exams</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Coaching for B.Tech mathematics, GATE, and other engineering-related mathematics examinations.
                        </p>
                        <button class="btn-primary mt-auto enroll-button" data-course="B.Tech, GATE & Other Exams" aria-label="Enroll in B.Tech & GATE course">Enroll Now</button>
                    </div>

                    <div class="card" data-course-category="General Math Support">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: HelpCircle -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-help-circle"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">General Math Support</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Flexible support for various other mathematical needs, including doubt clearing and specific topic mastery.
                        </p>
                        <button class="btn-primary mt-auto enroll-button" data-course="General Math Support" aria-label="Learn more about General Math Support">Learn More</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="page-section py-16 md:py-24 bg-white rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                   dark:bg-gray-800 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Why Choose MATHEMATICO?</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: UserCheck -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 dark:text-gray-100 transition-colors duration-300 ease-in-out">Experienced Educator</h3>
                        <p class="text-gray-600 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Learn from Dipanjan Chatterjee, M.Sc in Pure Maths, a highly qualified and passionate teacher.
                        </p>
                    </div>
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: Users -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 dark:text-gray-100 transition-colors duration-300 ease-in-out">Personalized Attention</h3>
                        <p class="text-gray-600 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Small batch sizes ensure individual focus and tailored guidance for every student.
                        </p>
                    </div>
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: FileText -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 dark:text-gray-100 transition-colors duration-300 ease-in-out">Comprehensive Curriculum</h3>
                        <p class="text-gray-600 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Well-structured curriculum covering all essential topics for various boards and exams.
                        </p>
                    </div>
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: ClipboardCheck -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-check"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="m9 14 2 2 4-4"/></svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 dark:text-gray-100 transition-colors duration-300 ease-in-out">Regular Assessments</h3>
                        <p class="text-gray-600 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Frequent tests and quizzes to track progress and identify areas for improvement.
                        </p>
                    </div>
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: Clock -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 dark:text-gray-100 transition-colors duration-300 ease-in-out">Flexible Timings</h3>
                        <p class="text-gray-600 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Options for various batch timings to suit different student schedules.
                        </p>
                    </div>
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <div class="text-indigo-600 mb-4">
                            <!-- Lucide Icon: TrendingUp (reused for results) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-3 dark:text-gray-100 transition-colors duration-300 ease-in-out">Proven Results</h3>
                        <p class="text-gray-600 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            A strong track record of students achieving excellent scores in their exams.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section id="testimonials" class="page-section py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                     dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">What Our Students Say</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card">
                        <img src="Gemini_Generated_Image_q97477q97477q974.png" alt="Student testimonial image for Anjali Sharma" class="w-24 h-24 rounded-full mb-6 testimonial-img" loading="lazy">
                        <p class="text-lg text-gray-700 italic mb-4 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            "MATHEMATICO transformed my understanding of complex topics. The teachers are incredibly supportive and make learning fun!"
                        </p>
                        <p class="font-semibold text-indigo-700 dark:text-indigo-400 transition-colors duration-300 ease-in-out">- Anjali Sharma</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300 ease-in-out">Class 10 Student</p>
                    </div>
                    <div class="card">
                        <img src="Gemini_Generated_Image_a45rwpa45rwpa45r.png" alt="Student testimonial image for Rahul Verma" class="w-24 h-24 rounded-full mb-6 testimonial-img" loading="lazy">
                        <p class="text-lg text-gray-700 italic mb-4 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            "Thanks to their rigorous practice and clear explanations, I scored exceptionally well in my JEE Mains math section."
                        </p>
                        <p class="font-semibold text-indigo-700 dark:text-indigo-400 transition-colors duration-300 ease-in-out">- Rahul Verma</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300 ease-in-out">JEE Aspirant</p>
                    </div>
                    <div class="card">
                        <img src="Gemini_Generated_Image_r5xzj2r5xzj2r5xz.png" alt="Student testimonial image for Priya Singh" class="w-24 h-24 rounded-full mb-6 testimonial-img" loading="lazy">
                        <p class="text-lg text-gray-700 italic mb-4 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            "The personalized attention helped me grasp concepts I struggled with. Highly recommend for anyone looking to improve their math skills."
                        </p>
                        <p class="font-semibold text-indigo-700 dark:text-indigo-400 transition-colors duration-300 ease-in-out">- Priya Singh</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300 ease-in-out">Class 12 Student</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Success Stories Section -->
        <section id="success-stories" class="page-section py-16 md:py-24 bg-white rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-800 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Our Success Stories</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card bg-gray-50 dark:bg-gray-700">
                        <img src="Gemini_Generated_Image_ep7txep7txep7txe.png" alt="Successful student Rohan Kumar" class="w-24 h-24 rounded-full mb-6 success-story-img" loading="lazy">
                        <h3 class="text-xl font-bold text-gray-900 mb-2 dark:text-gray-100">Rohan Kumar</h3>
                        <p class="text-gray-600 mb-4 dark:text-gray-300">IIT Bombay (JEE Advanced 2024)</p>
                        <p class="text-gray-700 italic dark:text-gray-300">"Achieved my dream thanks to the focused guidance and challenging problems provided by MATHEMATICO!"</p>
                    </div>
                    <div class="card bg-gray-50 dark:bg-gray-700">
                        <img src="Gemini_Generated_Image_uwrcaruwrcaruwrc.png" alt="Successful student Sanya Gupta" class="w-24 h-24 rounded-full mb-6 success-story-img" loading="lazy">
                        <h3 class="text-xl font-bold text-gray-900 mb-2 dark:text-gray-100">Sanya Gupta</h3>
                        <p class="text-gray-600 mb-4 dark:text-gray-300">ISI Kolkata (B.Stat Entrance 2024)</p>
                        <p class="text-gray-700 italic dark:text-gray-300">"The in-depth concept clarity and problem-solving strategies were key to my success in ISI entrance."</p>
                    </div>
                    <div class="card bg-gray-50 dark:bg-gray-700">
                        <img src="Gemini_Generated_Image_o8ymwgo8ymwgo8ym.png" alt="Successful student Arjun Das" class="w-24 h-24 rounded-full mb-6 success-story-img" loading="lazy">
                        <h3 class="text-xl font-bold text-gray-900 mb-2 dark:text-gray-100">Arjun Das</h3>
                        <p class="text-gray-600 mb-4 dark:text-gray-300">Class 12 Board Topper (98% Maths)</p>
                        <p class="text-gray-700 italic dark:text-gray-300">"From struggling to topping, MATHEMATICO made math my favorite subject. Highly grateful!"</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq" class="page-section py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Frequently Asked Questions</h2>
                <div class="max-w-3xl mx-auto text-left">
                    <div class="accordion-item bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-4">
                        <div class="accordion-header text-gray-900 dark:text-gray-100" data-target="faq-1">
                            <h3 class="text-xl font-semibold">What are the batch timings and class frequency?</h3>
                            <svg class="w-6 h-6 transform transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div id="faq-1" class="accordion-content text-gray-700 dark:text-gray-300">
                            <p>Our batches typically run twice a week for regular courses, with additional sessions for competitive exam preparation. Specific timings vary by batch and will be communicated upon enrollment. We offer both morning and evening slots.</p>
                        </div>
                    </div>
                    <div class="accordion-item bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-4">
                        <div class="accordion-header text-gray-900 dark:text-gray-100" data-target="faq-2">
                            <h3 class="text-xl font-semibold">What is the fee structure for different courses?</h3>
                            <svg class="w-6 h-6 transform transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div id="faq-2" class="accordion-content text-gray-700 dark:text-gray-300">
                            <p>Our fee structure is competitive and varies based on the course and duration. Please contact us directly via phone or email, or visit our centers in Madhyamgram or Barasat for detailed fee information and any ongoing discounts.</p>
                        </div>
                    </div>
                    <div class="accordion-item bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-4">
                        <div class="accordion-header text-gray-900 dark:text-gray-100" data-target="faq-3">
                            <h3 class="text-xl font-semibold">Do you provide study materials and mock tests?</h3>
                            <svg class="w-6 h-6 transform transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div id="faq-3" class="accordion-content text-gray-700 dark:text-gray-300">
                            <p>Yes, we provide comprehensive study materials, including notes, practice sheets, and recommended book lists. Regular mock tests are conducted to assess student progress and prepare them for exams. Performance analysis and feedback are also provided.</p>
                        </div>
                    </div>
                    <div class="accordion-item bg-white dark:bg-gray-800 rounded-xl shadow-lg mb-4">
                        <div class="accordion-header text-gray-900 dark:text-gray-100" data-target="faq-4">
                            <h3 class="text-xl font-semibold">What is the student-teacher ratio?</h3>
                            <svg class="w-6 h-6 transform transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </div>
                        <div id="faq-4" class="accordion-content text-gray-700 dark:text-gray-300">
                            <p>We maintain small batch sizes to ensure personalized attention for every student. Our student-teacher ratio is designed to foster an interactive learning environment where individual doubts can be addressed effectively.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="page-section py-16 md:py-24 bg-white rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8 mb-8
                       dark:bg-gray-800 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Get in Touch with MATHEMATICO</h2>
                <div class="flex flex-col md:flex-row justify-center items-center gap-10">
                    <div class="md:w-1/2 contact-info-card dark:bg-gray-700">
                        <h3 class="text-2xl font-bold text-gray-900 mb-6 dark:text-gray-100 transition-colors duration-300 ease-in-out">Contact Information</h3>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: User -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user mr-3"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            <strong>Instructor:</strong> Dipanjan Chatterjee, M.Sc in Pure Maths
                        </p>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: Phone -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-phone mr-3"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6.86-6.86A19.79 19.79 0 0 1 2 4.18 2 2 0 0 1 4.18 2h3a2 2 0 0 1 2 1.72l.4 4.5a2 2 0 0 1-1.16 2.01l-1.68.84a10 10 0 0 0 6.16 6.16l.84-1.68a2 2 0 0 1 2.01-1.16l4.5.4a2 2 0 0 1 1.72 2z"/></svg>
                            <strong>Phone:</strong> +91 9051089673
                        </p>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: Phone (reused) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-phone mr-3"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6.86-6.86A19.79 19.79 0 0 1 2 4.18 2 2 0 0 1 4.18 2h3a2 2 0 0 1 2 1.72l.4 4.5a2 2 0 0 1-1.16 2.01l-1.68.84a10 10 0 0 0 6.16 6.16l.84-1.68a2 2 0 0 1 2.01-1.16l4.5.4a2 2 0 0 1 1.72 2z"/></svg>
                            <strong>Landline:</strong> +91-3331712372
                        </p>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" alt="WhatsApp icon" class="w-6 h-6 mr-3">
                            <strong>WhatsApp:</strong> <a href="https://wa.link/80qjr2" class="text-indigo-600 hover:underline dark:text-indigo-400" aria-label="Chat with us on WhatsApp">+91 9748559613</a>
                        </p>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: Mail -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail mr-3"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                            <strong>Email:</strong> dipanjanchatterjee23@gmail.com
                        </p>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: MapPin -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-3"><path d="M12 12.72a3 3 0 1 0 0-5.44 3 3 0 0 0 0 5.44Z"/><path d="M18.8 12.52a7 7 0 1 0-13.6 0c.5 1.5 1.7 2.9 3.5 4.1L12 22l5.3-5.3c1.8-1.2 3-2.6 3.5-4.1Z"/></svg>
                            <strong>Locations:</strong> Madhyamgram & Barasat
                        </p>
                        <p class="text-lg text-gray-700 mb-4 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: Send (often used for Telegram) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send mr-3"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                            <strong>Telegram:</strong> <a href="https://t.me/dipanjan9271" class="text-indigo-600 hover:underline dark:text-indigo-400" aria-label="Join our Telegram group">Join our Telegram Group</a>
                        </p>
                        <p class="text-lg text-gray-700 flex items-center dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            <!-- Lucide Icon: Chalkboard (for classes) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chalkboard mr-3"><path d="M4 13.5V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5.5"/><path d="M12 16v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-4"/><path d="M4 16v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-4"/></svg>
                            <strong>Classes Available:</strong> Offline & Online
                        </p>
                        <h3 class="text-2xl font-bold text-gray-900 mt-8 mb-6 dark:text-gray-100 transition-colors duration-300 ease-in-out">Social Media</h3>
                        <div class="flex flex-wrap gap-4">
                            <a href="https://www.facebook.com/share/15gcnh3AeR/" target="_blank" rel="noopener noreferrer" class="text-gray-700 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out flex items-center" aria-label="Facebook Page">
                                <svg class="w-8 h-8 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.262c-1.225 0-1.624.767-1.624 1.569V12h2.773l-.443 2.89h-2.33V22C18.343 21.128 22 16.991 22 12z"></path></svg>
                                Facebook (Page)
                            </a>
                            <a href="https://www.facebook.com/share/g/1F6pJ4QCqJ/" target="_blank" rel="noopener noreferrer" class="text-gray-700 hover:text-indigo-700 dark:text-gray-300 dark:hover:text-indigo-400 transition-colors duration-300 ease-in-out flex items-center" aria-label="Facebook Group">
                                <svg class="w-8 h-8 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.262c-1.225 0-1.624.767-1.624 1.569V12h2.773l-.443 2.89h-2.33V22C18.343 21.128 22 16.991 22 12z"></path></svg>
                                Facebook (Group)
                            </a>
                        </div>
                    </div>
                    <div class="md:w-1/2 contact-info-card dark:bg-gray-700">
                        <h3 class="text-2xl font-bold text-gray-900 mb-6 dark:text-gray-100 transition-colors duration-300 ease-in-out">Send Us a Message</h3>
                        <!-- Google Form for Contact Us -->
                        <form action="YOUR_CONTACT_GOOGLE_FORM_ACTION_URL" method="POST" target="_blank">
                            <div class="mb-4">
                                <label for="contact-name" class="sr-only">Your Name</label>
                                <input type="text" id="contact-name" name="entry.YOUR_NAME_FIELD_ID" placeholder="Your Name" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500
                                                                 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 transition-colors duration-300 ease-in-out" required aria-required="true">
                            </div>
                            <div class="mb-4">
                                <label for="contact-email" class="sr-only">Your Email</label>
                                <input type="email" id="contact-email" name="entry.YOUR_EMAIL_FIELD_ID" placeholder="Your Email" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500
                                                                  dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 transition-colors duration-300 ease-in-out" required aria-required="true">
                            </div>
                            <div class="mb-6">
                                <label for="contact-message" class="sr-only">Your Message</label>
                                <textarea id="contact-message" rows="5" name="entry.YOUR_MESSAGE_FIELD_ID" placeholder="Your Message" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500
                                                                   dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 transition-colors duration-300 ease-in-out" required aria-required="true"></textarea>
                            </div>
                            <button type="submit" class="btn-primary w-full shadow-md transform hover:scale-105" aria-label="Send your message">
                                Send Message
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Google Maps Section - Moved directly into Contact Section -->
                <div id="google-maps-container" class="mt-16">
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Find Us on the Map</h2>
                    <div class="aspect-w-16 aspect-h-9 w-full h-96 bg-gray-200 rounded-xl overflow-hidden shadow-lg dark:bg-gray-700">
                        <iframe
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4432.401265241326!2d88.4793815759286!3d22.724858927371475!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x39f8a30058617907%3A0x6fb9d10ae1c6b946!2sMATHEMATICO(Maths%20Coaching)%20By%20DipanjanSir!5e1!3m2!1sen!2sin!4v1752090333658!5m2!1sen!2sin"
                            width="100%"
                            height="400"
                            style="border:0;"
                            allowfullscreen=""
                            loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"
                            title="Google Maps location of MATHEMATICO">
                        </iframe>
                    </div>
                </div>
            </div>
        </section>

        <!-- Useful Links Section -->
        <section id="links" class="page-section py-16 md:py-24 bg-white rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8 mb-8
                       dark:bg-gray-800 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100 transition-colors duration-300 ease-in-out">Useful Links</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">Official Page Link</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Visit our main official page for more information.
                        </p>
                        <a href="https://www.facebook.com/share/15gcnh3AeR/" target="_blank" rel="noopener noreferrer" class="btn-primary mt-auto" aria-label="Go to official page">
                            <!-- Lucide Icon: ExternalLink -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link inline-block mr-2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" x2="21" y1="14" y2="3"/></svg>
                            Go to Page
                        </a>
                    </div>
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">Community Group Link</h3>
                        <p class="text-gray-600 mb-6 dark:text-gray-300 transition-colors duration-300 ease-in-out">
                            Join our community group for discussions and updates.
                        </p>
                        <a href="https://www.facebook.com/share/g/1F6pJ4QCqJ/" target="_blank" rel="noopener noreferrer" class="btn-primary mt-auto" aria-label="Join community group">
                            <!-- Lucide Icon: Users (reused) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users inline-block mr-2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            Join Group
                        </a>
                    </div>
                    <!-- New Section: Email Newsletter Sign-up -->
                    <div class="card bg-indigo-50 dark:bg-gray-700">
                        <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100 transition-colors duration-300 ease-in-out">Newsletter Sign-up</h3>
                        <!-- Google Form for Newsletter -->
                        <form action="YOUR_NEWSLETTER_GOOGLE_FORM_ACTION_URL" method="POST" target="_blank" class="flex flex-col gap-4 w-full">
                            <label for="newsletter-email" class="sr-only">Email address</label>
                            <input type="email" id="newsletter-email" name="entry.YOUR_NEWSLETTER_EMAIL_FIELD_ID" placeholder="Your email address" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500
                                                                   dark:bg-gray-800 dark:text-gray-100 dark:border-gray-600 transition-colors duration-300 ease-in-out" required aria-required="true">
                            <button type="submit" class="btn-primary" aria-label="Subscribe to newsletter">
                                <!-- Lucide Icon: Mail (reused) -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail inline-block mr-2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                                Subscribe
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Book List Page -->
        <section id="book-list-page" class="page-section hidden py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100">Book List</h2>

                <!-- Admin Add/Edit Book Form (visible only to admin) -->
                <div id="book-list-admin-panel" class="admin-panel hidden bg-white p-8 rounded-xl shadow-lg mb-8 dark:bg-gray-800">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100">Add/Edit Book</h3>
                    <form id="add-edit-book-form" class="text-left">
                        <input type="hidden" id="book-id">
                        <div class="mb-4">
                            <label for="book-title" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Title:</label>
                            <input type="text" id="book-title" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-4">
                            <label for="book-author" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Author:</label>
                            <input type="text" id="book-author" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-4">
                            <label for="book-category" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Category:</label>
                            <input type="text" id="book-category" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-4">
                            <label for="book-description" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Description:</label>
                            <textarea id="book-description" rows="3" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="book-url" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">URL (Optional):</label>
                            <input type="url" id="book-url" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
                        </div>
                        <button type="submit" class="btn-primary">Save Book</button>
                        <button type="button" id="cancel-edit-book-btn" class="bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out ml-2 hidden">Cancel Edit</button>
                    </form>
                </div>

                <!-- Book List Display -->
                <div id="book-list-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <p id="book-list-loading" class="text-gray-600 dark:text-gray-300 text-center col-span-full">Loading books... <span class="spinner"></span></p>
                    <!-- Books will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Problems Page -->
        <section id="problems-page" class="page-section hidden py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100">Practice Problems</h2>

                <!-- Admin Add Problem Form (visible only to admin) -->
                <div id="problems-admin-panel" class="admin-panel hidden bg-white p-8 rounded-xl shadow-lg mb-8 dark:bg-gray-800">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100">Add New Problem</h3>
                    <form id="add-problem-form" class="text-left">
                        <input type="hidden" id="problem-id">
                        <div class="mb-4">
                            <label for="problem-title" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Title:</label>
                            <input type="text" id="problem-title" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-4">
                            <label for="problem-category" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Category:</label>
                            <select id="problem-category" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                                <option value="">Select Category</option>
                                <option value="Geometry">Geometry</option>
                                <option value="Inequality">Inequality</option>
                                <option value="Number Theory">Number Theory</option>
                                <option value="Calculus">Calculus</option>
                                <option value="Algebra">Algebra</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="problem-description" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Description:</label>
                            <textarea id="problem-description" rows="5" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="problem-solution-url" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Solution URL (Optional):</label>
                            <input type="url" id="problem-solution-url" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
                        </div>
                        <button type="submit" class="btn-primary">Add Problem</button>
                        <button type="button" id="cancel-edit-problem-btn" class="bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out ml-2 hidden">Cancel Edit</button>
                    </form>
                </div>

                <!-- Problem Categories and Display -->
                <div id="problems-display" class="text-left">
                    <p id="problems-loading" class="text-gray-600 dark:text-gray-300 text-center col-span-full">Loading problems... <span class="spinner"></span></p>
                    <!-- Problems will be dynamically loaded here, categorized -->
                </div>
            </div>
        </section>

        <!-- Gallery Page -->
        <section id="gallery-page" class="page-section hidden py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100">Our Gallery</h2>

                <!-- Admin Add Gallery Post Form (visible only to admin) -->
                <div id="gallery-admin-panel" class="admin-panel hidden bg-white p-8 rounded-xl shadow-lg mb-8 dark:bg-gray-800">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100">Add New Gallery Post</h3>
                    <form id="add-gallery-form" class="text-left">
                        <input type="hidden" id="gallery-post-id">
                        <div class="mb-4">
                            <label for="gallery-image-upload" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Upload Image:</label>
                            <input type="file" id="gallery-image-upload" accept="image/*" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
                            <div id="gallery-image-preview-container" class="mt-2 flex items-center space-x-4">
                                <img id="gallery-image-preview" src="#" alt="Image Preview" class="max-w-[150px] max-h-[150px] rounded-md object-cover hidden">
                                <span id="gallery-upload-spinner" class="spinner hidden"></span>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="gallery-caption" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Caption:</label>
                            <textarea id="gallery-caption" rows="3" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Post</button>
                        <button type="button" id="cancel-edit-gallery-btn" class="bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out ml-2 hidden">Cancel Edit</button>
                    </form>
                </div>

                <!-- Gallery Display -->
                <div id="gallery-display" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <p id="gallery-loading" class="text-gray-600 dark:text-gray-300 text-center col-span-full">Loading gallery... <span class="spinner"></span></p>
                    <!-- Gallery posts will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Blog Page -->
        <section id="blog-page" class="page-section hidden py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100">Our Blog & Articles</h2>

                <!-- Admin Add Blog Post Form (visible only to admin) -->
                <div id="blog-admin-panel" class="admin-panel hidden bg-white p-8 rounded-xl shadow-lg mb-8 dark:bg-gray-800">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 dark:text-gray-100">Add New Blog Post</h3>
                    <form id="add-blog-form" class="text-left">
                        <input type="hidden" id="blog-post-id">
                        <div class="mb-4">
                            <label for="blog-title" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Title:</label>
                            <input type="text" id="blog-title" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-4">
                            <label for="blog-image-upload" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Upload Image (Optional):</label>
                            <input type="file" id="blog-image-upload" accept="image/*" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600">
                            <div id="blog-image-preview-container" class="mt-2 flex items-center space-x-4">
                                <img id="blog-image-preview" src="#" alt="Image Preview" class="max-w-[150px] max-h-[150px] rounded-md object-cover hidden">
                                <span id="blog-upload-spinner" class="spinner hidden"></span>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="blog-content" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Content:</label>
                            <textarea id="blog-content" rows="10" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Save Blog Post</button>
                        <button type="button" id="cancel-edit-blog-btn" class="bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out ml-2 hidden">Cancel Edit</button>
                    </form>
                </div>

                <!-- Blog Posts Display -->
                <div id="blog-display" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <p id="blog-loading" class="text-gray-600 dark:text-gray-300 text-center col-span-full">Loading blog posts... <span class="spinner"></span></p>
                    <!-- Blog posts will be dynamically loaded here -->
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section id="admin-page" class="page-section hidden py-16 md:py-24 bg-gray-100 rounded-lg shadow-md mx-4 md:mx-auto max-w-6xl mt-8 mb-8
                       dark:bg-gray-950 dark:shadow-xl transition-colors duration-300 ease-in-out">
            <div class="container mx-auto px-6 md:px-12 text-center">
                <h2 class="text-4xl font-extrabold text-gray-900 mb-12 dark:text-gray-100">Admin Panel</h2>

                <!-- Admin Authentication Section -->
                <div id="auth-section" class="bg-white p-8 rounded-xl shadow-lg mb-8 dark:bg-gray-800 max-w-md mx-auto">
                    <h3 id="auth-heading" class="text-2xl font-bold text-gray-900 mb-6 dark:text-gray-100">Admin Login</h3>

                    <div id="login-form-container">
                        <div class="mb-4">
                            <label for="admin-email" class="sr-only">Email</label>
                            <input type="email" id="admin-email" placeholder="Email" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-6">
                            <label for="admin-password" class="sr-only">Password</label>
                            <input type="password" id="admin-password" placeholder="Password" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <button id="login-btn" class="w-full bg-indigo-600 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-indigo-700 transition duration-300 ease-in-out mb-4">Login</button>
                        <button id="google-login-btn" class="w-full bg-red-600 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-red-700 transition duration-300 ease-in-out flex items-center justify-center gap-2 mb-4">
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12.24 10.285V11.85h2.956c-.134 1.54-.888 2.766-2.956 2.766-1.72 0-3.12-1.398-3.12-3.12s1.4-3.12 3.12-3.12c.884 0 1.637.368 2.22 1.01L15.99 7.74c-1.01-1.01-2.31-1.637-3.75-1.637-3.12 0-5.64 2.52-5.64 5.64s2.52 5.64 5.64 5.64c3.12 0 5.42-2.26 5.42-5.54 0-.39-.03-.76-.08-1.12h-5.34z" fill="#fff"/></svg>
                            Sign in with Google
                        </button>
                        <button id="register-toggle-btn" class="w-full bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out mb-4">Register</button>
                        <button id="forgot-password-btn" class="w-full text-indigo-600 hover:underline text-md font-semibold dark:text-indigo-400">Forgot Password?</button>
                        <p id="auth-message" class="text-red-500 mt-4 hidden"></p>
                    </div>

                    <div id="register-form-container" class="hidden">
                        <div class="mb-4">
                            <label for="register-email" class="sr-only">Email</label>
                            <input type="email" id="register-email" placeholder="Email" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <div class="mb-6">
                            <label for="register-password" class="sr-only">Password</label>
                            <input type="password" id="register-password" placeholder="Password" class="w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-gray-100 dark:border-gray-600" required>
                        </div>
                        <button id="register-btn" class="w-full bg-indigo-600 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-indigo-700 transition duration-300 ease-in-out mb-4">Register</button>
                        <button id="login-toggle-btn" class="w-full bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out">Back to Login</button>
                        <p id="register-message" class="text-red-500 mt-4 hidden"></p>
                    </div>

                    <div id="admin-dashboard" class="hidden">
                        <p class="text-gray-700 dark:text-gray-300 mb-4">Welcome, <span id="user-email-display" class="font-bold"></span>!</p>
                        <p class="text-gray-700 dark:text-gray-300 mb-6">Your User ID: <span id="user-id-display" class="font-mono text-sm break-all"></span></p>
                        <button id="logout-btn" class="w-full bg-red-600 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-red-700 transition duration-300 ease-in-out">Logout</button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Floating WhatsApp CTA Button -->
    <a href="https://wa.me/919748559613" class="fixed bottom-6 right-6 z-50 bg-green-500 p-3 rounded-full shadow-lg hover:scale-110 transition-transform duration-300 whatsapp-cta" aria-label="Chat on WhatsApp">
        <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" alt="WhatsApp icon" class="w-10 h-10">
    </a>

    <!-- Scroll-to-top Button -->
    <button id="scroll-to-top" aria-label="Scroll to top">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <!-- Enrollment Modal Structure -->
    <div id="enrollment-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="enrollment-modal-title">
        <div class="modal-content">
            <button class="modal-close-button" aria-label="Close enrollment form">&times;</button>
            <h3 id="enrollment-modal-title" class="text-2xl font-bold text-gray-900 mb-6 dark:text-gray-100">Enroll in <span id="modal-course-name"></span></h3>
            <!-- Google Form embedded via iframe -->
            <iframe id="enrollment-google-form-iframe" src="" frameborder="0" marginheight="0" marginwidth="0" title="Enrollment Form">Loading...</iframe>
        </div>
    </div>

    <!-- Message Box Modal -->
    <div id="message-box-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="message-box-title">
        <div class="modal-content max-w-sm h-auto">
            <button class="modal-close-button" aria-label="Close message box">&times;</button>
            <h3 id="message-box-title" class="text-xl font-bold text-gray-900 mb-4 dark:text-gray-100"></h3>
            <p id="message-box-content" class="text-gray-700 dark:text-gray-300 mb-4"></p>
            <button id="message-box-ok-btn" class="btn-primary">OK</button>
        </div>
    </div>

    <!-- Blog Detail Modal Structure -->
    <div id="blog-detail-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="blog-detail-modal-title">
        <div class="modal-content">
            <button class="modal-close-button" aria-label="Close blog post">&times;</button>
            <h3 id="blog-detail-title" class="text-3xl font-bold text-gray-900 mb-4 dark:text-gray-100"></h3>
            <p id="blog-detail-date" class="text-sm text-gray-500 dark:text-gray-400 mb-4"></p>
            <img id="blog-detail-image" src="" alt="Blog Post Image" class="hidden w-full h-auto object-cover rounded-md mb-6">
            <div id="blog-detail-content" class="text-gray-700 dark:text-gray-300 prose prose-indigo max-w-none">
                <!-- Blog content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Gallery Image Modal Structure (New) -->
    <div id="gallery-image-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="gallery-image-modal-title">
        <div class="modal-content">
            <button class="modal-close-button" aria-label="Close image view">&times;</button>
            <img id="gallery-modal-image" src="" alt="Expanded Gallery Image" class="w-full h-auto object-contain rounded-md" loading="lazy">
            <p id="gallery-modal-caption" class="modal-caption"></p>
        </div>
    </div>


    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, sendPasswordResetEmail, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot, query, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Global Firebase variables, initialized to null
        let app = null;
        let db = null;
        let auth = null;
        let storage = null; // Initialize storage
        let userId = 'anonymous'; // Default to anonymous
        let isAdmin = false; // Global flag for admin status
        let appId = null; // Declare appId globally
        let allBlogPosts = []; // Store all blog posts for modal display

        // Admin Auth Elements - Moved to global scope
        const adminEmailInput = document.getElementById('admin-email');
        const adminPasswordInput = document.getElementById('admin-password');
        const loginBtn = document.getElementById('login-btn');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const registerToggleBtn = document.getElementById('register-toggle-btn');
        const forgotPasswordBtn = document.getElementById('forgot-password-btn');
        const authMessage = document.getElementById('auth-message');

        const registerEmailInput = document.getElementById('register-email');
        const registerPasswordInput = document.getElementById('register-password');
        const registerBtn = document.getElementById('register-btn');
        const loginToggleBtn = document.getElementById('login-toggle-btn');
        const registerMessage = document.getElementById('register-message');

        const logoutBtn = document.getElementById('logout-btn');

        const loginFormContainer = document.getElementById('login-form-container');
        const registerFormContainer = document.getElementById('register-form-container');
        const adminDashboard = document.getElementById('admin-dashboard');
        const userEmailDisplay = document.getElementById('user-email-display');
        const userIdDisplay = document.getElementById('user-id-display');
        const authHeading = document.getElementById('auth-heading');


        // Function to initialize Firebase and attach listeners
        async function initializeFirebaseAndListeners() {
            // Firebase configuration and initialization
            // IMPORTANT: Replace with your actual Firebase project configuration
            // You can find these values in your Firebase project console:
            // Project settings -> General -> Your apps -> Web app -> Firebase SDK snippet (Config)
            const firebaseConfig = {
                apiKey: "AIzaSyCIKdwTmJxok8VodE3lUI-1UlH1WNadfpc",
                authDomain: "mathematico-website.firebaseapp.com",
                projectId: "mathematico-website",
                storageBucket: "mathematico-website.appspot.com", // Corrected storageBucket
                messagingSenderId: "186709981685",
                appId: "1:186709981685:web:b86177e07352cb5f1c48bc",
                measurementId: "G-5Z24Z4Q97Q"
            };

            // Log the provided Canvas variables for debugging
            console.log("Canvas __app_id:", typeof __app_id !== 'undefined' ? __app_id : 'undefined');
            console.log("Canvas __initial_auth_token:", typeof __initial_auth_token !== 'undefined' ? 'Token present' : 'Token not present');

            // Assign to the global appId variable
            appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId;

            // Check if essential Firebase config values are provided
            if (firebaseConfig.apiKey && firebaseConfig.projectId && firebaseConfig.authDomain && firebaseConfig.appId) {
                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    storage = getStorage(app); // Initialize Firebase Storage
                    console.log("Firebase initialized successfully.");

                    // Authenticate user with custom token if provided by Canvas, otherwise anonymously
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        const userCredential = await signInWithCustomToken(auth, __initial_auth_token);
                        userId = userCredential.user.uid;
                        console.log("Firebase signed in with custom token:", userId);
                    } else {
                        const userCredential = await signInAnonymously(auth);
                        userId = userCredential.user.uid;
                        console.log("Firebase signed in anonymously:", userId);
                    }

                    // After initial sign-in, set up auth state listener and attach Firebase-dependent event listeners
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            userId = user.uid;
                            console.log("Auth state changed: User is logged in.", userId);
                            checkAdminStatus(user);
                        } else {
                            userId = 'anonymous';
                            isAdmin = false;
                            console.log("Auth state changed: User is logged out.");
                            updateAdminUI(); // Update UI for logged out state
                        }
                    });
                    // Initial check after sign-in
                    checkAdminStatus(auth.currentUser);

                    // Attach Firebase-dependent event listeners here
                    attachFirebaseEventListeners();

                } catch (error) {
                    console.error("Error during Firebase initialization or initial authentication:", error);
                    showMessageBox("Authentication Error", "Failed to initialize Firebase or authenticate. Some features may not be available. Check console for details.");
                    // Hide all admin panels if Firebase auth fails
                    document.querySelectorAll('.admin-panel').forEach(el => el.classList.add('hidden'));
                    document.getElementById('auth-section').classList.add('hidden');
                }
            } else {
                console.error("Firebase config is incomplete. Please ensure all API keys, project IDs, and auth domains are correctly set.");
                showMessageBox("Configuration Error", "Firebase is not fully configured. Admin and data management features will be disabled. Check console for details.");
                // Hide all admin panels if Firebase is not initialized
                document.querySelectorAll('.admin-panel').forEach(el => el.classList.add('hidden'));
                document.getElementById('auth-section').classList.add('hidden');
            }
        }

        // Function to check admin status (using a Firestore 'roles' collection for flexibility)
        async function checkAdminStatus(user) {
            if (!db || !user) {
                isAdmin = false;
                updateAdminUI();
                return;
            }
            try {
                // Corrected Firestore path for user roles
                const userDocRef = doc(getCollectionRef("users"), user.uid); // Using getCollectionRef for consistency
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists() && userDocSnap.data().role === 'admin') {
                    isAdmin = true;
                    console.log("User is an admin.");
                } else {
                    isAdmin = false;
                    console.log("User is not an admin or role not set.");
                }
            } catch (e) {
                console.error("Error checking admin status:", e);
                isAdmin = false;
            }
            updateAdminUI();
            initializeFirestoreListeners(); // Initialize listeners after auth state and admin status are known
        }

        // Function to update UI based on admin status
        function updateAdminUI() {
            const adminPanels = document.querySelectorAll('.admin-panel');
            const adminIndicator = document.getElementById('admin-mode-indicator');
            const authSection = document.getElementById('auth-section'); // This is already global

            if (isAdmin) {
                adminPanels.forEach(panel => panel.classList.remove('hidden'));
                adminIndicator.classList.add('active');
                if (auth.currentUser) {
                    authHeading.textContent = "Admin Dashboard";
                    loginFormContainer.classList.add('hidden');
                    registerFormContainer.classList.add('hidden');
                    adminDashboard.classList.remove('hidden');
                    userEmailDisplay.textContent = auth.currentUser.email || 'N/A';
                    userIdDisplay.textContent = auth.currentUser.uid;
                }
            } else {
                adminPanels.forEach(panel => panel.classList.add('hidden'));
                adminIndicator.classList.remove('active');
                if (auth.currentUser && !auth.currentUser.isAnonymous) { // Logged in but not admin
                    authHeading.textContent = "User Profile";
                    loginFormContainer.classList.add('hidden');
                    registerFormContainer.classList.add('hidden');
                    adminDashboard.classList.remove('hidden');
                    userEmailDisplay.textContent = auth.currentUser.email || 'N/A';
                    userIdDisplay.textContent = auth.currentUser.uid;
                } else { // Not logged in or anonymous
                    authHeading.textContent = "Admin Login";
                    loginFormContainer.classList.remove('hidden');
                    registerFormContainer.classList.add('hidden');
                    adminDashboard.classList.add('hidden');
                }
            }
        }


        // --- DOM Elements ---
        const themeToggle = document.getElementById('theme-toggle');
        const htmlElement = document.documentElement;
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        const hamburgerButton = document.getElementById('hamburger-button');
        const navbarLinks = document.getElementById('navbar-links');
        const scrollToTopButton = document.getElementById('scroll-to-top');
        const enrollmentModal = document.getElementById('enrollment-modal');
        const modalCloseButton = document.querySelector('#enrollment-modal .modal-close-button');
        const enrollButtons = document.querySelectorAll('.enroll-button');
        const modalCourseName = document.getElementById('modal-course-name');
        const enrollmentGoogleFormIframe = document.getElementById('enrollment-google-form-iframe');

        const mainContentContainer = document.getElementById('main-content-container');
        const pageSections = document.querySelectorAll('.page-section');

        // Book List Elements
        const bookListAdminPanel = document.getElementById('book-list-admin-panel');
        const addEditBookForm = document.getElementById('add-edit-book-form');
        const bookIdInput = document.getElementById('book-id');
        const bookTitleInput = document.getElementById('book-title');
        const bookAuthorInput = document.getElementById('book-author');
        const bookCategoryInput = document.getElementById('book-category');
        const bookDescriptionInput = document.getElementById('book-description');
        const bookUrlInput = document.getElementById('book-url');
        const cancelEditBookBtn = document.getElementById('cancel-edit-book-btn');
        const bookListDisplay = document.getElementById('book-list-display');
        const bookListLoading = document.getElementById('book-list-loading');

        // Problems Elements
        const problemsAdminPanel = document.getElementById('problems-admin-panel');
        const addProblemForm = document.getElementById('add-problem-form');
        const problemIdInput = document.getElementById('problem-id');
        const problemTitleInput = document.getElementById('problem-title');
        const problemCategorySelect = document.getElementById('problem-category');
        const problemDescriptionInput = document.getElementById('problem-description');
        const problemSolutionUrlInput = document.getElementById('problem-solution-url');
        const cancelEditProblemBtn = document.getElementById('cancel-edit-problem-btn');
        const problemsDisplay = document.getElementById('problems-display');
        const problemsLoading = document.getElementById('problems-loading');

        // Gallery Elements
        const galleryAdminPanel = document.getElementById('gallery-admin-panel');
        const addGalleryForm = document.getElementById('add-gallery-form');
        const galleryPostIdInput = document.getElementById('gallery-post-id');
        // Changed from URL input to file input
        const galleryImageUploadInput = document.getElementById('gallery-image-upload');
        const galleryImagePreview = document.getElementById('gallery-image-preview');
        const galleryUploadSpinner = document.getElementById('gallery-upload-spinner');
        const galleryCaptionInput = document.getElementById('gallery-caption');
        const cancelEditGalleryBtn = document.getElementById('cancel-edit-gallery-btn');
        const galleryDisplay = document.getElementById('gallery-display');
        const galleryLoading = document.getElementById('gallery-loading');
        // New Gallery Image Modal Elements
        const galleryImageModal = document.getElementById('gallery-image-modal');
        const galleryImageModalCloseButton = document.querySelector('#gallery-image-modal .modal-close-button');
        const galleryModalImage = document.getElementById('gallery-modal-image');
        const galleryModalCaption = document.getElementById('gallery-modal-caption');


        // Blog Elements
        const blogAdminPanel = document.getElementById('blog-admin-panel');
        const addBlogForm = document.getElementById('add-blog-form');
        const blogPostIdInput = document.getElementById('blog-post-id');
        const blogTitleInput = document.getElementById('blog-title');
        // Changed from URL input to file input
        const blogImageUploadInput = document.getElementById('blog-image-upload');
        const blogImagePreview = document.getElementById('blog-image-preview');
        const blogUploadSpinner = document.getElementById('blog-upload-spinner');
        const blogContentInput = document.getElementById('blog-content');
        const cancelEditBlogBtn = document.getElementById('cancel-edit-blog-btn');
        const blogDisplay = document.getElementById('blog-display');
        const blogLoading = document.getElementById('blog-loading');

        // Message Box Elements
        const messageBoxModal = document.getElementById('message-box-modal');
        const messageBoxTitle = document.getElementById('message-box-title');
        const messageBoxContent = document.getElementById('message-box-content');
        const messageBoxOkBtn = document.getElementById('message-box-ok-btn');
        const messageBoxCloseButton = document.querySelector('#message-box-modal .modal-close-button');

        // Blog Detail Modal Elements
        const blogDetailModal = document.getElementById('blog-detail-modal');
        const blogDetailModalCloseButton = document.querySelector('#blog-detail-modal .modal-close-button');
        const blogDetailTitle = document.getElementById('blog-detail-title');
        const blogDetailDate = document.getElementById('blog-detail-date');
        const blogDetailImage = document.getElementById('blog-detail-image');
        const blogDetailContent = document.getElementById('blog-detail-content');

        // Get the Mathematico logo element
        const mathematicoLogo = document.getElementById('mathematico-logo');

        // IMPORTANT: Replace with your actual Google Form embed URL and field IDs
        // To get these:
        // 1. Go to your Google Form.
        // 2. Click "Send" -> "Embed HTML" tab. Copy the 'src' URL from the iframe.
        // 3. For field IDs, click "Send" -> "Get pre-filled link". Fill out a test entry, then copy the link.
        //    The field IDs will be in the URL (e.g., entry.123456789).
        const GOOGLE_FORM_ENROLLMENT_BASE_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdPNf9oCLYIa3rEbVCoNCGBgEh4DGRdy0XxYxAM5JUWQEWOXA/viewform?embedded=true"; // <--- REPLACE THIS
        const GOOGLE_FORM_ENROLLMENT_FIELD_IDS = {
            course: "entry.1828229222",
            studentName: "entry.40854499",
            parentName: "entry.1504263384",
            contactNumber: "entry.605564464",
            email: "entry.352430613",
            message: "entry.341859473"
        };
        const YOUR_CONTACT_GOOGLE_FORM_ACTION_URL = "https://docs.google.com/forms/u/0/d/17FUuG9CCOmfUcsNLVilnCRjT938wU-V8GxIJdhJrKrM/formResponse"; // <--- REPLACE THIS
        const YOUR_NEWSLETTER_GOOGLE_FORM_ACTION_URL = "https://docs.google.com/forms/u/0/d/1X2Blec-M2Ve1qj3AtDndgzcEQOEErAEaF6Loyw_NTLg/formResponse"; // <--- REPLACE THIS
        const YOUR_NAME_FIELD_ID = "320465823";
        const YOUR_EMAIL_FIELD_ID = "196734286";
        const YOUR_MESSAGE_FIELD_ID = "1567514947";
        const YOUR_NEWSLETTER_EMAIL_FIELD_ID = "1002277897";

        // --- General Functions ---

        // Function to set the theme and update icon visibility
        function setTheme(theme) {
            if (theme === 'dark') {
                htmlElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                htmlElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }
            if (theme === 'dark') {
                document.body.classList.add('dark:bg-gray-900', 'dark:text-gray-100');
                document.body.classList.remove('bg-gray-50', 'text-gray-800');
            } else {
                document.body.classList.remove('dark:bg-gray-900', 'dark:text-gray-100');
                document.body.classList.add('bg-gray-50', 'text-gray-800');
            }
        }

        // SPA Navigation Function
        function renderPage(pageId) {
            pageSections.forEach(section => {
                section.classList.add('hidden');
            });
            const targetSection = document.getElementById(pageId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                // If the contact page is rendered, also ensure the map container is visible
                if (pageId === 'contact') {
                    const googleMapsContainer = document.getElementById('google-maps-container');
                    if (googleMapsContainer) {
                        googleMapsContainer.classList.remove('hidden');
                    }
                }
                // Scroll to top of the new page
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Global variable to hold the current confirm callback
        let currentConfirmCallback = null;

        // Function to show a custom message box
        function showMessageBox(title, message, isConfirm = false, onConfirm = null) {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBoxOkBtn.textContent = isConfirm ? "Yes" : "OK";

            // Clear any previous click handler on the OK button
            if (currentConfirmCallback) {
                messageBoxOkBtn.removeEventListener('click', currentConfirmCallback);
                currentConfirmCallback = null;
            }
            // Ensure the generic hideMessageBox listener is also removed if it was added
            messageBoxOkBtn.removeEventListener('click', hideMessageBox);

            // Remove any existing 'No' button listener and hide it
            const noBtn = document.getElementById('message-box-no-btn');
            if (noBtn) {
                noBtn.removeEventListener('click', hideMessageBox); // Remove its listener
                noBtn.classList.add('hidden'); // Hide it
            }

            if (isConfirm) {
                currentConfirmCallback = async () => { // Make sure this is async
                    hideMessageBox(); // Hide first
                    if (onConfirm) {
                        await onConfirm(); // Await the async callback
                    }
                };
                messageBoxOkBtn.addEventListener('click', currentConfirmCallback);

                // Add a "No" button for confirmation if it doesn't exist
                let newNoBtn = document.createElement('button'); // Create new button
                newNoBtn.id = 'message-box-no-btn';
                newNoBtn.className = 'bg-gray-400 text-white px-6 py-3 rounded-full text-md font-semibold hover:bg-gray-500 transition duration-300 ease-in-out ml-2';
                newNoBtn.textContent = 'No';
                messageBoxOkBtn.parentNode.appendChild(newNoBtn);

                newNoBtn.addEventListener('click', hideMessageBox); // No button always just hides
                newNoBtn.classList.remove('hidden');
            } else {
                // For non-confirm messages, just hide the box
                messageBoxOkBtn.addEventListener('click', hideMessageBox);
            }
            messageBoxModal.classList.add('active');
        }

        // Function to hide the custom message box
        function hideMessageBox() {
            messageBoxModal.classList.remove('active');
            // Clean up the specific OK button handler when hiding
            if (currentConfirmCallback) {
                messageBoxOkBtn.removeEventListener('click', currentConfirmCallback);
                currentConfirmCallback = null;
            }
            // Also remove the generic hideMessageBox listener if it was added
            messageBoxOkBtn.removeEventListener('click', hideMessageBox);

            // Hide and clean up the 'No' button if it exists
            const noBtn = document.getElementById('message-box-no-btn');
            if (noBtn) {
                noBtn.removeEventListener('click', hideMessageBox); // Remove No button handler
                noBtn.classList.add('hidden');
            }
        }


        // --- Event Listeners and Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme) {
                setTheme(savedTheme);
            } else if (prefersDark) {
                setTheme('dark');
            } else {
                setTheme('light');
            }

            // Initialize accordion
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const contentId = header.dataset.target;
                    const content = document.getElementById(contentId);
                    const icon = header.querySelector('svg');

                    document.querySelectorAll('.accordion-content.active').forEach(otherContent => {
                        if (otherContent.id !== contentId) {
                            otherContent.classList.remove('active');
                            const otherHeader = otherContent.previousElementSibling;
                            if (otherHeader) {
                                const otherIcon = otherHeader.querySelector('svg');
                                if (otherIcon) {
                                    otherIcon.classList.remove('rotate-180');
                                }
                            }
                        }
                    });

                    content.classList.toggle('active');
                    icon.classList.toggle('rotate-180');
                });
            });

            // Handle initial page load based on URL hash
            const initialHash = window.location.hash.substring(1);
            if (initialHash && document.getElementById(initialHash)) {
                renderPage(initialHash);
            } else {
                renderPage('home'); // Default to home page
            }

            // Update navigation links to use renderPage
            navbarLinks.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    // Check if it's a dropdown item (course filter)
                    const courseFilter = link.dataset.courseFilter;
                    // Check if it's a dropdown toggle (which has href="javascript:void(0)")
                    const isDropdownToggle = link.getAttribute('href') === 'javascript:void(0)';

                    if (courseFilter) {
                        e.preventDefault(); // Prevent default link behavior for dropdown items
                        renderPage('courses'); // Navigate to courses page
                        // Scroll to the specific course card
                        setTimeout(() => {
                            const targetCourseCard = document.querySelector(`[data-course-category="${courseFilter}"]`);
                            if (targetCourseCard) {
                                targetCourseCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        }, 100); // Small delay to allow page render
                    } else if (isDropdownToggle) { // Handle dropdown toggles (Courses and More)
                        e.preventDefault(); // Prevent default for dropdown toggles to avoid page jump
                        const parentDropdown = link.closest('.dropdown');
                        if (parentDropdown) {
                            // On mobile, always toggle the dropdown
                            // On desktop, only toggle if it's not a direct navigation link within the dropdown
                            if (window.innerWidth < 768 || (window.innerWidth >= 768 && parentDropdown.classList.contains('dropdown'))) {
                                parentDropdown.classList.toggle('active');
                            }
                        }
                    } else {
                        // Prevent default anchor link behavior only if it's an internal link
                        if (link.getAttribute('href').startsWith('#')) {
                            e.preventDefault();
                            const pageId = link.getAttribute('href').substring(1);
                            renderPage(pageId);
                        }
                    }

                    // Close hamburger menu on mobile after clicking a link
                    if (navbarLinks.classList.contains('active')) {
                        navbarLinks.classList.remove('active');
                    }
                    // Close dropdown menu if open (for desktop dropdowns after clicking an item or if it's not a toggle)
                    const parentDropdown = link.closest('.dropdown');
                    if (parentDropdown && !isDropdownToggle) { // Only close if it's not the toggle itself
                        parentDropdown.classList.remove('active');
                    }
                });
            });

            // Close dropdowns when clicking anywhere else on the document (for desktop)
            document.addEventListener('click', (e) => {
                if (window.innerWidth >= 768) { // Only for desktop dropdowns
                    document.querySelectorAll('.navbar-links .dropdown').forEach(dropdown => {
                        // Check if the click was outside the current dropdown
                        if (!dropdown.contains(e.target)) {
                            dropdown.classList.remove('active');
                        }
                    });
                }
            });

            // Add specific event listeners for the hero section buttons
            const startLearningBtn = document.querySelector('#home a[href="#courses"]');
            const seeResultsBtn = document.querySelector('#home a[href="#testimonials"]');

            if (startLearningBtn) {
                startLearningBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage('courses');
                });
            }

            if (seeResultsBtn) {
                seeResultsBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    renderPage('testimonials');
                });
            }

            // Fix for Mathematico logo not taking back to home
            if (mathematicoLogo) {
                mathematicoLogo.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent default anchor behavior
                    renderPage('home'); // Navigate to the home section
                    // Close hamburger menu if open
                    if (navbarLinks.classList.contains('active')) {
                        navbarLinks.classList.remove('active');
                    }
                });
            }


            // Update form actions for Google Forms (these don't depend on Firebase directly)
            const contactForm = document.querySelector('#contact form');
            if (contactForm) {
                contactForm.action = YOUR_CONTACT_GOOGLE_FORM_ACTION_URL;
                contactForm.querySelector('#contact-name').name = `entry.${YOUR_NAME_FIELD_ID}`;
                contactForm.querySelector('#contact-email').name = `entry.${YOUR_EMAIL_FIELD_ID}`;
                contactForm.querySelector('#contact-message').name = `entry.${YOUR_MESSAGE_FIELD_ID}`;
            }

            const newsletterForm = document.querySelector('#links form');
            if (newsletterForm) {
                newsletterForm.action = YOUR_NEWSLETTER_GOOGLE_FORM_ACTION_URL;
                newsletterForm.querySelector('#newsletter-email').name = `entry.${YOUR_NEWSLETTER_EMAIL_FIELD_ID}`;
            }

            // Call Firebase initialization and listener attachment function
            initializeFirebaseAndListeners();
        });

        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            if (htmlElement.classList.contains('dark')) {
                setTheme('light');
            } else {
                setTheme('dark');
            }
        });

        // Toggle hamburger menu on click
        hamburgerButton.addEventListener('click', () => {
            console.log("Hamburger button clicked!"); // Added for debugging
            navbarLinks.classList.toggle('active');
        });

        // Close hamburger menu when a link is clicked (for smooth scrolling)
        navbarLinks.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                if (navbarLinks.classList.contains('active')) {
                    navbarLinks.classList.remove('active');
                }
            });
        });

        // Scroll-to-top button functionality
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                scrollToTopButton.style.display = 'block';
            } else {
                scrollToTopButton.style.display = 'none';
            }
        });

        scrollToTopButton.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Enrollment modal functionality
        enrollButtons.forEach(button => {
            button.addEventListener('click', () => {
                const courseName = button.dataset.course;
                modalCourseName.textContent = courseName;
                // Construct the Google Form URL with pre-filled course name
                const formUrl = `${GOOGLE_FORM_ENROLLMENT_BASE_URL}&${GOOGLE_FORM_ENROLLMENT_FIELD_IDS.course}=${encodeURIComponent(courseName)}`;
                enrollmentGoogleFormIframe.src = formUrl;
                enrollmentModal.classList.add('active');
            });
        });

        modalCloseButton.addEventListener('click', () => {
            enrollmentModal.classList.remove('active');
            enrollmentGoogleFormIframe.src = ""; // Clear iframe src when closing
        });

        enrollmentModal.addEventListener('click', (e) => {
            if (e.target === enrollmentModal) {
                enrollmentModal.classList.remove('active');
                enrollmentGoogleFormIframe.src = ""; // Clear iframe src when closing
            }
        });

        // Message Box Event Listeners (only for close button and modal background)
        messageBoxCloseButton.addEventListener('click', hideMessageBox);
        messageBoxModal.addEventListener('click', (e) => {
            if (e.target === messageBoxModal) {
                hideMessageBox();
            }
        });

        // Blog Detail Modal Event Listeners
        blogDetailModalCloseButton.addEventListener('click', () => {
            blogDetailModal.classList.remove('active');
            blogDetailImage.classList.add('hidden'); // Hide image when closing
            blogDetailImage.src = ''; // Clear image src
        });

        blogDetailModal.addEventListener('click', (e) => {
            if (e.target === blogDetailModal) {
                blogDetailModal.classList.remove('active');
                blogDetailImage.classList.add('hidden'); // Hide image when closing
                blogDetailImage.src = ''; // Clear image src
            }
        });

        // Gallery Image Modal Event Listeners (New)
        galleryImageModalCloseButton.addEventListener('click', () => {
            galleryImageModal.classList.remove('active');
            galleryModalImage.src = ''; // Clear image src
            galleryModalCaption.textContent = ''; // Clear caption
        });

        galleryImageModal.addEventListener('click', (e) => {
            if (e.target === galleryImageModal) {
                galleryImageModal.classList.remove('active');
                galleryModalImage.src = ''; // Clear image src
                galleryModalCaption.textContent = ''; // Clear caption
            }
        });


        // --- Firebase Authentication Functions ---

        // Function to attach all event listeners that depend on Firebase being initialized
        function attachFirebaseEventListeners() {
            // Admin Auth Elements Listeners
            loginBtn.addEventListener('click', async () => {
                const email = adminEmailInput.value;
                const password = adminPasswordInput.value;
                authMessage.classList.add('hidden');
                if (!email || !password) {
                    authMessage.textContent = "Please enter email and password.";
                    authMessage.classList.remove('hidden');
                    return;
                }
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log("Logged in:", userCredential.user.email);
                    // onAuthStateChanged listener will handle UI update and admin status check
                } catch (error) {
                    console.error("Login error:", error.message);
                    authMessage.textContent = `Login failed: ${error.message}`;
                    authMessage.classList.remove('hidden');
                }
            });

            googleLoginBtn.addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                authMessage.classList.add('hidden');
                try {
                    const userCredential = await signInWithPopup(auth, provider);
                    console.log("Logged in with Google:", userCredential.user.email);
                    // Corrected Firestore path for user roles
                    const userDocRef = doc(getCollectionRef("users"), userCredential.user.uid); // Using getCollectionRef
                    const userDocSnap = await getDoc(userDocRef);
                    if (!userDocSnap.exists()) {
                        await setDoc(userDocRef, { role: 'user', email: userCredential.user.email, created_at: new Date() });
                        console.log("New Google user registered with 'user' role.");
                    }
                    // onAuthStateChanged listener will handle UI update and admin status check
                } catch (error) {
                    console.error("Google login error:", error.message);
                    authMessage.textContent = `Google login failed: ${error.message}`;
                    authMessage.classList.remove('hidden');
                }
            });

            registerBtn.addEventListener('click', async () => {
                console.log("Register button clicked.");
                const email = registerEmailInput.value;
                const password = registerPasswordInput.value;
                registerMessage.classList.add('hidden'); // Hide previous messages
                registerMessage.textContent = ''; // Clear previous text

                if (!email || !password) {
                    registerMessage.textContent = "Please enter both email and password.";
                    registerMessage.classList.remove('hidden');
                    console.log("Validation failed: email or password missing.");
                    return;
                }

                try {
                    console.log("Attempting to register user with email:", email);
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log("Registered user UID:", userCredential.user.uid);

                    // --- ADDED LOG HERE ---
                    console.log(`Attempting to set user role for UID: ${userCredential.user.uid} at path: artifacts/${appId}/public/data/users`);

                    // Set user role in Firestore
                    // Corrected Firestore path for user roles
                    await setDoc(doc(getCollectionRef("users"), userCredential.user.uid), { // Using getCollectionRef
                        role: 'user', // Default role for new registrations
                        email: userCredential.user.email,
                        created_at: new Date()
                    });
                    console.log("User role successfully set in Firestore."); // Added success log

                    showMessageBox("Registration Successful", "You have successfully registered. You can now log in.");
                    // After successful registration, switch back to login form
                    loginFormContainer.classList.remove('hidden');
                    registerFormContainer.classList.add('hidden');
                    adminEmailInput.value = email; // Pre-fill email for easy login
                    adminPasswordInput.value = '';
                    registerEmailInput.value = '';
                    registerPasswordInput.value = '';
                } catch (error) {
                    console.error("Registration error:", error); // Log full error object for debugging
                    let errorMessage = "Registration failed. Please try again.";
                    if (error.code) {
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage = "The email address is already in use by another account.";
                                break;
                            case 'auth/invalid-email':
                                errorMessage = "The email address is not valid.";
                                break;
                            case 'auth/operation-not-allowed':
                                errorMessage = "Email/password accounts are not enabled. Please contact support.";
                                break;
                            case 'auth/weak-password':
                                errorMessage = "The password is too weak. Please choose a stronger password (at least 6 characters).";
                                break;
                            default:
                                errorMessage = `Registration failed: ${error.message}`;
                        }
                    }
                    registerMessage.textContent = errorMessage;
                    registerMessage.classList.remove('hidden');
                }
            });

            logoutBtn.addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    console.log("Logged out successfully.");
                    showMessageBox("Logged Out", "You have been successfully logged out.");
                } catch (error) {
                    console.error("Logout error:", error.message);
                    showMessageBox("Logout Error", `Failed to logout: ${error.message}`);
                }
            });

            forgotPasswordBtn.addEventListener('click', async () => {
                const email = adminEmailInput.value;
                if (!email) {
                    authMessage.textContent = "Please enter your email to reset password.";
                    authMessage.classList.remove('hidden');
                    return;
                }
                try {
                    await sendPasswordResetEmail(auth, email);
                    showMessageBox("Password Reset", `Password reset email sent to ${email}. Please check your inbox.`);
                } catch (error) {
                    console.error("Forgot password error:", error.message);
                    showMessageBox("Password Reset Error", `Failed to send reset email: ${error.message}`);
                }
            });

            // Toggle between Login and Register forms
            registerToggleBtn.addEventListener('click', () => {
                loginFormContainer.classList.add('hidden');
                registerFormContainer.classList.remove('hidden');
                authMessage.classList.add('hidden'); // Clear login message
                registerMessage.classList.add('hidden'); // Clear register message
                document.getElementById('auth-heading').textContent = "Admin Registration";
            });

            loginToggleBtn.addEventListener('click', () => {
                loginFormContainer.classList.remove('hidden');
                registerFormContainer.classList.add('hidden');
                authMessage.classList.add('hidden'); // Clear login message
                registerMessage.classList.add('hidden'); // Clear register message
                document.getElementById('auth-heading').textContent = "Admin Login";
            });

            // Admin CRUD form submissions (these were already correctly placed, but ensuring context)
            addEditBookForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    showMessageBox("Permission Denied", "You must be logged in as an admin to manage books.");
                    return;
                }
                const bookId = bookIdInput.value;
                const bookData = {
                    title: bookTitleInput.value,
                    author: bookAuthorInput.value,
                    category: bookCategoryInput.value,
                    description: bookDescriptionInput.value,
                    url: bookUrlInput.value || null,
                    date_posted: new Date() // Use server timestamp for consistency
                };

                try {
                    if (bookId) {
                        await updateDoc(doc(getCollectionRef("books"), bookId), bookData);
                        showMessageBox("Success", "Book updated successfully!");
                    } else {
                        await addDoc(getCollectionRef("books"), bookData);
                        showMessageBox("Success", "Book added successfully!");
                    }
                    addEditBookForm.reset();
                    bookIdInput.value = ''; // Clear book ID
                    cancelEditBookBtn.classList.add('hidden');
                } catch (e) {
                    console.error("Error saving book: ", e);
                    showMessageBox("Error", "Error saving book. Please try again.");
                }
            });

            cancelEditBookBtn.addEventListener('click', () => {
                addEditBookForm.reset();
                bookIdInput.value = '';
                cancelEditBookBtn.classList.add('hidden');
            });

            addProblemForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    showMessageBox("Permission Denied", "You must be logged in as an admin to manage problems.");
                    return;
                }
                const problemId = problemIdInput.value;
                const problemData = {
                    title: problemTitleInput.value,
                    category: problemCategorySelect.value,
                    description: problemDescriptionInput.value,
                    solution_url: problemSolutionUrlInput.value || null,
                    date_posted: new Date()
                };

                try {
                    if (problemId) {
                        await updateDoc(doc(getCollectionRef("problems"), problemId), problemData);
                        showMessageBox("Success", "Problem updated successfully!");
                    } else {
                        await addDoc(getCollectionRef("problems"), problemData);
                        showMessageBox("Success", "Problem added successfully!");
                    }
                    addProblemForm.reset();
                    problemIdInput.value = '';
                    cancelEditProblemBtn.classList.add('hidden');
                } catch (e) {
                    console.error("Error saving problem: ", e);
                    showMessageBox("Error", "Error saving problem. Please try again.");
                }
            });

            cancelEditProblemBtn.addEventListener('click', () => {
                addProblemForm.reset();
                problemIdInput.value = '';
                cancelEditProblemBtn.classList.add('hidden');
            });

            // --- Image Upload Functions ---

            // Function to upload file to Firebase Storage
            async function uploadFile(file, folderPath, spinnerElement, previewElement) {
                if (!file) return null;

                spinnerElement.classList.remove('hidden'); // Show spinner
                previewElement.classList.add('hidden'); // Hide preview during upload

                const storageRef = ref(storage, `${folderPath}/${file.name}_${Date.now()}`);
                const uploadTask = uploadBytesResumable(storageRef, file);

                return new Promise((resolve, reject) => {
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            // You can show progress here if needed
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            console.log('Upload is ' + progress + '% done');
                        },
                        (error) => {
                            spinnerElement.classList.add('hidden');
                            console.error("Upload failed:", error);
                            showMessageBox("Upload Error", `Image upload failed: ${error.message}`);
                            reject(error);
                        },
                        () => {
                            getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                                spinnerElement.classList.add('hidden');
                                previewElement.src = downloadURL;
                                previewElement.classList.remove('hidden');
                                resolve(downloadURL);
                            }).catch(error => {
                                spinnerElement.classList.add('hidden');
                                console.error("Error getting download URL:", error);
                                showMessageBox("Error", "Failed to get image download URL.");
                                reject(error);
                            });
                        }
                    );
                });
            }

            // Event listener for Gallery image upload input
            galleryImageUploadInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        galleryImagePreview.src = e.target.result;
                        galleryImagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    galleryImagePreview.classList.add('hidden');
                    galleryImagePreview.src = '#';
                }
            });

            // Event listener for Blog image upload input
            blogImageUploadInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        blogImagePreview.src = e.target.result;
                        blogImagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    blogImagePreview.classList.add('hidden');
                    blogImagePreview.src = '#';
                }
            });


            addGalleryForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    showMessageBox("Permission Denied", "You must be logged in as an admin to manage gallery posts.");
                    return;
                }

                const postId = galleryPostIdInput.value;
                const caption = galleryCaptionInput.value;
                const imageFile = galleryImageUploadInput.files[0];
                let imageUrl = galleryImagePreview.src !== '#' && galleryImagePreview.src !== window.location.href ? galleryImagePreview.src : null; // Keep existing if no new file

                try {
                    if (imageFile) {
                        // Upload new image if selected
                        imageUrl = await uploadFile(imageFile, 'gallery_images', galleryUploadSpinner, galleryImagePreview);
                    } else if (!postId && !imageUrl) {
                        // If it's a new post and no image is uploaded
                        showMessageBox("Error", "Please upload an image for the gallery post.");
                        return;
                    }

                    const postData = {
                        imageUrl: imageUrl,
                        caption: caption,
                        date_posted: new Date()
                    };

                    if (postId) {
                        await updateDoc(doc(getCollectionRef("gallery_posts"), postId), postData);
                        showMessageBox("Success", "Gallery post updated successfully!");
                    } else {
                        await addDoc(getCollectionRef("gallery_posts"), postData);
                        showMessageBox("Success", "Gallery post added successfully!");
                    }
                    addGalleryForm.reset();
                    galleryPostIdInput.value = '';
                    cancelEditGalleryBtn.classList.add('hidden');
                    galleryImagePreview.classList.add('hidden'); // Hide preview
                    galleryImagePreview.src = '#'; // Clear preview source
                    galleryImageUploadInput.value = ''; // Clear file input
                } catch (e) {
                    console.error("Error saving gallery post: ", e);
                    showMessageBox("Error", "Error saving gallery post. Please try again.");
                }
            });

            cancelEditGalleryBtn.addEventListener('click', () => {
                addGalleryForm.reset();
                galleryPostIdInput.value = '';
                cancelEditGalleryBtn.classList.add('hidden');
                galleryImagePreview.classList.add('hidden'); // Hide preview
                galleryImagePreview.src = '#'; // Clear preview source
                galleryImageUploadInput.value = ''; // Clear file input
            });

            addBlogForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (!isAdmin) {
                    showMessageBox("Permission Denied", "You must be logged in as an admin to manage blog posts.");
                    return;
                }
                const postId = blogPostIdInput.value;
                const title = blogTitleInput.value;
                const content = blogContentInput.value;
                const imageFile = blogImageUploadInput.files[0];
                let imageUrl = blogImagePreview.src !== '#' && blogImagePreview.src !== window.location.href ? blogImagePreview.src : null; // Keep existing if no new file


                try {
                    if (imageFile) {
                        // Upload new image if selected
                        imageUrl = await uploadFile(imageFile, 'blog_images', blogUploadSpinner, blogImagePreview);
                    }
                    // No error if no image is uploaded for blog, as it's optional

                    const postData = {
                        title: title,
                        imageUrl: imageUrl,
                        content: content,
                        date_posted: new Date()
                    };

                    if (postId) {
                        await updateDoc(doc(getCollectionRef("blog_posts"), postId), postData);
                        showMessageBox("Success", "Blog post updated successfully!");
                    } else {
                        await addDoc(getCollectionRef("blog_posts"), postData);
                        showMessageBox("Success", "Blog post added successfully!");
                    }
                    addBlogForm.reset();
                    blogPostIdInput.value = '';
                    cancelEditBlogBtn.classList.add('hidden');
                    blogImagePreview.classList.add('hidden'); // Hide preview
                    blogImagePreview.src = '#'; // Clear preview source
                    blogImageUploadInput.value = ''; // Clear file input
                } catch (e) {
                    console.error("Error saving blog post: ", e);
                    showMessageBox("Error", "Error saving blog post. Please try again.");
                }
            });

            cancelEditBlogBtn.addEventListener('click', () => {
                addBlogForm.reset();
                blogPostIdInput.value = '';
                cancelEditBlogBtn.classList.add('hidden');
                blogImagePreview.classList.add('hidden'); // Hide preview
                blogImagePreview.src = '#'; // Clear preview source
                blogImageUploadInput.value = ''; // Clear file input
            });

            // This function is called after Firebase is initialized and authenticated
            initializeFirestoreListeners();
        }


        // --- Firestore Operations ---

        // Function to create a Firestore collection path based on app ID
        // Note: For a multi-user app where data is private to a user,
        // the path would be `artifacts/${appId}/users/${userId}/{collectionName}`
        // For public data editable by admin, it's `artifacts/${appId}/public/data/${collectionName}`
        function getCollectionRef(collectionName) {
            // Now appId is globally accessible
            // Special handling for 'users' collection to place it under 'public/data'
            if (collectionName === "users") {
                return collection(db, `artifacts/${appId}/public/data/users`);
            }
            return collection(db, `artifacts/${appId}/public/data/${collectionName}`);
        }

        // --- Book List Functions ---
        function renderBooks(snapshot) {
            bookListDisplay.innerHTML = ''; // Clear previous content
            const books = [];
            snapshot.forEach((doc) => {
                books.push({ id: doc.id, ...doc.data() });
            });

            // Client-side sorting by date_posted in descending order
            books.sort((a, b) => {
                const dateA = a.date_posted ? (a.date_posted.seconds || 0) : 0;
                const dateB = b.date_posted ? (b.date_posted.seconds || 0) : 0;
                return dateB - dateA;
            });

            if (books.length === 0) {
                bookListDisplay.innerHTML = '<p class="text-gray-600 dark:text-gray-300 text-center col-span-full">No books added yet.</p>';
            } else {
                books.forEach((book) => {
                    const bookElement = document.createElement('div');
                    bookElement.className = 'card text-left'; /* Applied card class */
                    bookElement.innerHTML = `
                        <h3 class="text-xl font-bold text-gray-900 mb-2 dark:text-gray-100">${book.title}</h3>
                        <p class="text-gray-600 dark:text-gray-300 mb-1"><strong>Author:</strong> ${book.author}</p>
                        <p class="text-gray-600 dark:text-gray-300 mb-2"><strong>Category:</strong> ${book.category}</p>
                        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4 flex-grow">${book.description}</p>
                        ${book.url ? `<a href="${book.url}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:underline dark:text-indigo-400 mt-auto">View Book &rarr;</a>` : ''}
                        ${isAdmin ? `
                            <div class="mt-4 flex space-x-2">
                                <button class="edit-book-btn bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" data-id="${book.id}">Edit</button>
                                <button class="delete-book-btn bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600" data-id="${book.id}">Delete</button>
                            </div>
                        ` : ''}
                    `;
                    bookListDisplay.appendChild(bookElement);
                });

                if (isAdmin) {
                    document.querySelectorAll('.edit-book-btn').forEach(button => {
                        button.addEventListener('click', (e) => editBook(e.target.dataset.id));
                    });
                    document.querySelectorAll('.delete-book-btn').forEach(button => {
                        button.addEventListener('click', (e) => deleteBook(e.target.dataset.id));
                    });
                }
            }
            bookListLoading.classList.add('hidden');
        }

        async function editBook(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to edit books.");
                return;
            }
            try {
                const docRef = doc(getCollectionRef("books"), id);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const book = docSnap.data();
                    bookIdInput.value = id;
                    bookTitleInput.value = book.title;
                    bookAuthorInput.value = book.author;
                    bookCategoryInput.value = book.category;
                    bookDescriptionInput.value = book.description;
                    bookUrlInput.value = book.url || '';
                    cancelEditBookBtn.classList.remove('hidden');
                    window.scrollTo({ top: bookListAdminPanel.offsetTop, behavior: 'smooth' }); // Scroll to form
                } else {
                    console.error("No such document!");
                    showMessageBox("Error", "Book not found for editing.");
                }
            } catch (e) {
                console.error("Error fetching document for edit: ", e);
                showMessageBox("Error", "Error fetching book data for editing.");
            }
        }

        async function deleteBook(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to delete books.");
                return;
            }
            showMessageBox("Confirm Delete", "Are you sure you want to delete this book?", true, async () => {
                try {
                    console.log(`Attempting to delete book with ID: ${id}. isAdmin: ${isAdmin}`); // Added log
                    await deleteDoc(doc(getCollectionRef("books"), id));
                    showMessageBox("Success", "Book deleted successfully!");
                    // Data will be re-rendered by the real-time listener
                } catch (e) {
                    console.error("Error deleting book: ", e);
                    showMessageBox("Error", "Error deleting book. Please try again. Details: " + e.message); // Added error detail
                }
            });
        }

        // --- Problems Functions ---
        function renderProblems(snapshot) {
            problemsDisplay.innerHTML = ''; // Clear previous content
            const problems = [];
            snapshot.forEach((doc) => {
                problems.push({ id: doc.id, ...doc.data() });
            });

            // Client-side sorting by date_posted in descending order
            problems.sort((a, b) => {
                const dateA = a.date_posted ? (a.date_posted.seconds || 0) : 0;
                const dateB = b.date_posted ? (b.date_posted.seconds || 0) : 0;
                return dateB - dateA;
            });

            const categories = ["Geometry", "Inequality", "Number Theory", "Calculus", "Algebra"];
            const problemsByCategory = {};
            categories.forEach(cat => problemsByCategory[cat] = []);

            if (problems.length === 0) {
                problemsDisplay.innerHTML = '<p class="text-gray-600 dark:text-gray-300 text-center col-span-full">No problems added yet.</p>';
            } else {
                problems.forEach(problem => {
                    if (problemsByCategory[problem.category]) {
                        problemsByCategory[problem.category].push(problem);
                    }
                });

                categories.forEach(category => {
                    if (problemsByCategory[category].length > 0) {
                        const categorySection = document.createElement('div');
                        categorySection.className = 'mb-8';
                        categorySection.innerHTML = `
                            <h3 class="text-3xl font-bold text-gray-900 mb-6 dark:text-gray-100 text-center">${category} Problems</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="problems-${category.replace(/\s/g, '-')}-container"></div>
                        `;
                        problemsDisplay.appendChild(categorySection);

                        const container = document.getElementById(`problems-${category.replace(/\s/g, '-')}-container`);
                        problemsByCategory[category].forEach(problem => {
                            const problemElement = document.createElement('div');
                            problemElement.className = 'card text-left'; /* Applied card class */
                            problemElement.innerHTML = `
                                <h4 class="text-xl font-bold text-gray-900 mb-2 dark:text-gray-100">${problem.title}</h4>
                                <p class="text-gray-700 dark:text-gray-300 text-sm mb-4 flex-grow">${problem.description}</p>
                                ${problem.solution_url ? `<a href="${problem.solution_url}" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:underline dark:text-indigo-400 mt-auto">View Solution &rarr;</a>` : ''}
                                ${isAdmin ? `
                                    <div class="mt-4 flex space-x-2">
                                        <button class="edit-problem-btn bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" data-id="${problem.id}">Edit</button>
                                        <button class="delete-problem-btn bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600" data-id="${problem.id}">Delete</button>
                                    </div>
                                ` : ''}
                            `;
                            container.appendChild(problemElement);
                        });
                    }
                });

                if (isAdmin) {
                    document.querySelectorAll('.edit-problem-btn').forEach(button => {
                        button.addEventListener('click', (e) => editProblem(e.target.dataset.id));
                    });
                    document.querySelectorAll('.delete-problem-btn').forEach(button => {
                        button.addEventListener('click', (e) => deleteProblem(e.target.dataset.id));
                    });
                }
            }
            problemsLoading.classList.add('hidden');
        }

        async function editProblem(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to edit problems.");
                return;
            }
            try {
                const docRef = doc(getCollectionRef("problems"), id);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const problem = docSnap.data();
                    problemIdInput.value = id;
                    problemTitleInput.value = problem.title;
                    problemCategorySelect.value = problem.category;
                    problemDescriptionInput.value = problem.description;
                    problemSolutionUrlInput.value = problem.solution_url || '';
                    cancelEditProblemBtn.classList.remove('hidden');
                    window.scrollTo({ top: problemsAdminPanel.offsetTop, behavior: 'smooth' });
                } else {
                    console.error("No such document!");
                    showMessageBox("Error", "Problem not found for editing.");
                }
            } catch (e) {
                console.error("Error fetching document for edit: ", e);
                showMessageBox("Error", "Error fetching problem data for editing.");
            }
        }

        async function deleteProblem(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to delete problems.");
                return;
            }
            showMessageBox("Confirm Delete", "Are you sure you want to delete this problem?", true, async () => {
                try {
                    console.log(`Attempting to delete problem with ID: ${id}. isAdmin: ${isAdmin}`); // Added log
                    await deleteDoc(doc(getCollectionRef("problems"), id));
                    showMessageBox("Success", "Problem deleted successfully!");
                    // Data will be re-rendered by the real-time listener
                } catch (e) {
                    console.error("Error deleting problem: ", e);
                    showMessageBox("Error", "Error deleting problem. Please try again. Details: " + e.message); // Added error detail
                }
            });
        }

        // --- Gallery Functions ---
        function renderGallery(snapshot) {
            galleryDisplay.innerHTML = ''; // Clear previous content
            const galleryPosts = [];
            snapshot.forEach((doc) => {
                galleryPosts.push({ id: doc.id, ...doc.data() });
            });

            // Client-side sorting by date_posted in descending order
            galleryPosts.sort((a, b) => {
                const dateA = a.date_posted ? (a.date_posted.seconds || 0) : 0;
                const dateB = b.date_posted ? (b.date_posted.seconds || 0) : 0;
                return dateB - dateA;
            });

            if (galleryPosts.length === 0) {
                galleryDisplay.innerHTML = '<p class="text-gray-600 dark:text-gray-300 text-center col-span-full">No gallery posts yet.</p>';
            } else {
                galleryPosts.forEach((post) => {
                    const postElement = document.createElement('div');
                    postElement.className = 'gallery-card relative overflow-hidden group cursor-pointer'; // Applied gallery-card class
                    postElement.setAttribute('data-image-url', post.imageUrl); // Add data attributes for modal
                    postElement.setAttribute('data-caption', post.caption);
                    postElement.innerHTML = `
                        <img src="${post.imageUrl}" alt="${post.caption}" class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x400/E0E7FF/4F46E5?text=Image+Not+Found';">
                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <p class="text-white text-lg font-semibold px-4">${post.caption}</p>
                        </div>
                        ${isAdmin ? `
                            <div class="absolute bottom-2 right-2 flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                <button class="edit-gallery-btn bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600" data-id="${post.id}">Edit</button>
                                <button class="delete-gallery-btn bg-red-500 text-white px-3 py-1 rounded-md text-sm hover:bg-red-600" data-id="${post.id}">Delete</button>
                            </div>
                        ` : ''}
                    `;
                    galleryDisplay.appendChild(postElement);
                });

                // Add event listeners for gallery image clicks to open modal
                document.querySelectorAll('#gallery-display > div').forEach(galleryItem => {
                    galleryItem.addEventListener('click', (e) => {
                        // Prevent opening modal if edit/delete button was clicked
                        if (e.target.classList.contains('edit-gallery-btn') || e.target.classList.contains('delete-gallery-btn')) {
                            return;
                        }
                        const imageUrl = galleryItem.dataset.imageUrl;
                        const caption = galleryItem.dataset.caption;
                        showGalleryImageDetail(imageUrl, caption);
                    });
                });

                if (isAdmin) {
                    document.querySelectorAll('.edit-gallery-btn').forEach(button => {
                        button.addEventListener('click', (e) => editGalleryPost(e.target.dataset.id));
                    });
                    document.querySelectorAll('.delete-gallery-btn').forEach(button => {
                        button.addEventListener('click', (e) => deleteGalleryPost(e.target.dataset.id));
                    });
                }
            }
            galleryLoading.classList.add('hidden');
        }

        // Function to show gallery image in modal (New)
        function showGalleryImageDetail(imageUrl, caption) {
            galleryModalImage.src = imageUrl;
            galleryModalImage.onerror = () => {
                galleryModalImage.src = 'https://placehold.co/600x400/E0E7FF/4F46E5?text=Image+Not+Found';
            };
            galleryModalCaption.textContent = caption;
            galleryImageModal.classList.add('active');
        }

        async function editGalleryPost(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to edit gallery posts.");
                return;
            }
            try {
                const docRef = doc(getCollectionRef("gallery_posts"), id);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const post = docSnap.data();
                    galleryPostIdInput.value = id;
                    galleryCaptionInput.value = post.caption;
                    
                    // Set preview image and show it
                    if (post.imageUrl) {
                        galleryImagePreview.src = post.imageUrl;
                        galleryImagePreview.classList.remove('hidden');
                    } else {
                        galleryImagePreview.classList.add('hidden');
                        galleryImagePreview.src = '#';
                    }
                    galleryImageUploadInput.value = ''; // Clear file input so user has to re-select
                    
                    cancelEditGalleryBtn.classList.remove('hidden');
                    window.scrollTo({ top: galleryAdminPanel.offsetTop, behavior: 'smooth' });
                } else {
                    console.error("No such document!");
                    showMessageBox("Error", "Gallery post not found for editing.");
                }
            } catch (e) {
                console.error("Error fetching document for edit: ", e);
                showMessageBox("Error", "Error fetching gallery post data for editing.");
            }
        }

        async function deleteGalleryPost(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to delete gallery posts.");
                return;
            }
            showMessageBox("Confirm Delete", "Are you sure you want to delete this gallery post?", true, async () => {
                try {
                    console.log(`Attempting to delete gallery post with ID: ${id}. isAdmin: ${isAdmin}`); // Added log
                    await deleteDoc(doc(getCollectionRef("gallery_posts"), id));
                    showMessageBox("Success", "Gallery post deleted successfully!");
                    // Data will be re-rendered by the real-time listener
                } catch (e) {
                    console.error("Error deleting gallery post: ", e);
                    showMessageBox("Error", "Error deleting gallery post. Please try again. Details: " + e.message); // Added error detail
                }
            });
        }

        // --- Blog Functions ---
        function renderBlogs(snapshot) {
            blogDisplay.innerHTML = ''; // Clear previous content
            allBlogPosts = []; // Clear previous posts and populate with new data
            const blogPosts = [];
            snapshot.forEach((doc) => {
                blogPosts.push({ id: doc.id, ...doc.data() });
            });

            // Client-side sorting by date_posted in descending order
            blogPosts.sort((a, b) => {
                const dateA = a.date_posted ? (a.date_posted.seconds || 0) : 0;
                const dateB = b.date_posted ? (b.date_posted.seconds || 0) : 0;
                return dateB - dateA;
            });
            allBlogPosts = blogPosts; // Store sorted posts

            if (blogPosts.length === 0) {
                blogDisplay.innerHTML = '<p class="text-gray-600 dark:text-gray-300 text-center col-span-full">No blog posts yet.</p>';
            } else {
                blogPosts.forEach((post) => {
                    const postElement = document.createElement('article');
                    postElement.className = 'blog-card p-6 rounded-xl shadow-lg text-left flex flex-col'; /* Applied blog-card class */
                    postElement.innerHTML = `
                        <h3 class="text-2xl font-bold text-gray-900 mb-3 dark:text-gray-100">${post.title}</h3>
                        ${post.imageUrl ? `<img src="${post.imageUrl}" alt="${post.title}" class="w-full h-48 object-cover rounded-md mb-4" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/600x200/E0E7FF/4F46E5?text=Blog+Image';">` : ''}
                        <p class="text-gray-600 mb-4 dark:text-gray-300 flex-grow">${post.content.substring(0, 150)}...</p>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">Posted on: ${post.date_posted ? new Date(post.date_posted.seconds * 1000).toLocaleDateString() : 'N/A'}</p>
                        <button class="read-more-blog-btn text-indigo-600 hover:underline dark:text-indigo-400 mt-auto" data-id="${post.id}" aria-label="Read more about ${post.title}">Read More &rarr;</button>
                        ${isAdmin ? `
                            <div class="mt-4 flex space-x-2">
                                <button class="edit-blog-btn bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" data-id="${post.id}">Edit</button>
                                <button class="delete-blog-btn bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600" data-id="${post.id}">Delete</button>
                            </div>
                        ` : ''}
                    `;
                    blogDisplay.appendChild(postElement);
                });

                // Add event listeners for "Read More" buttons
                document.querySelectorAll('.read-more-blog-btn').forEach(button => {
                    button.addEventListener('click', (e) => showBlogDetail(e.target.dataset.id));
                });

                if (isAdmin) {
                    document.querySelectorAll('.edit-blog-btn').forEach(button => {
                        button.addEventListener('click', (e) => editBlogPost(e.target.dataset.id));
                    });
                    document.querySelectorAll('.delete-blog-btn').forEach(button => {
                        button.addEventListener('click', (e) => deleteBlogPost(e.target.dataset.id));
                    });
                }
            }
            blogLoading.classList.add('hidden');
        }

        function showBlogDetail(id) {
            const post = allBlogPosts.find(p => p.id === id);
            if (post) {
                blogDetailTitle.textContent = post.title;
                blogDetailDate.textContent = `Posted on: ${post.date_posted ? new Date(post.date_posted.seconds * 1000).toLocaleDateString() : 'N/A'}`;
                blogDetailContent.innerHTML = `<p>${post.content.replace(/\n/g, '</p><p>')}</p>`; // Basic line break to paragraph conversion

                if (post.imageUrl) {
                    blogDetailImage.src = post.imageUrl;
                    blogDetailImage.classList.remove('hidden');
                    blogDetailImage.onerror = () => {
                        blogDetailImage.src = 'https://placehold.co/600x200/E0E7FF/4F46E5?text=Blog+Image';
                    };
                } else {
                    blogDetailImage.classList.add('hidden');
                    blogDetailImage.src = '';
                }
                blogDetailModal.classList.add('active');
            } else {
                showMessageBox("Error", "Blog post not found.");
            }
        }

        async function editBlogPost(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to edit blog posts.");
                return;
            }
            try {
                const docRef = doc(getCollectionRef("blog_posts"), id);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const post = docSnap.data();
                    blogPostIdInput.value = id;
                    blogTitleInput.value = post.title;
                    blogContentInput.value = post.content;
                    
                    // Set preview image and show it
                    if (post.imageUrl) {
                        blogImagePreview.src = post.imageUrl;
                        blogImagePreview.classList.remove('hidden');
                    } else {
                        blogImagePreview.classList.add('hidden');
                        blogImagePreview.src = '#';
                    }
                    blogImageUploadInput.value = ''; // Clear file input so user has to re-select
                    
                    cancelEditBlogBtn.classList.remove('hidden');
                    window.scrollTo({ top: blogAdminPanel.offsetTop, behavior: 'smooth' });
                } else {
                    console.error("No such document!");
                    showMessageBox("Error", "Blog post not found for editing.");
                }
            } catch (e) {
                console.error("Error fetching document for edit: ", e);
                showMessageBox("Error", "Error fetching blog post data for editing.");
            }
        }

        async function deleteBlogPost(id) {
            if (!isAdmin) {
                showMessageBox("Permission Denied", "You must be logged in as an admin to delete blog posts.");
                return;
            }
            showMessageBox("Confirm Delete", "Are you sure you want to delete this blog post?", true, async () => {
                try {
                    console.log(`Attempting to delete blog post with ID: ${id}. isAdmin: ${isAdmin}`); // Added log
                    await deleteDoc(doc(getCollectionRef("blog_posts"), id));
                    showMessageBox("Success", "Blog post deleted successfully!");
                    // Data will be re-rendered by the real-time listener
                } catch (e) {
                    console.error("Error deleting blog post: ", e);
                    showMessageBox("Error", "Error deleting blog post. Please try again. Details: " + e.message); // Added error detail
                }
            } );
        }

        // This function is called after Firebase is initialized and authenticated
        function initializeFirestoreListeners() {
            if (db) {
                // Real-time listener for books
                onSnapshot(query(getCollectionRef("books")), (snapshot) => { // Removed orderBy
                    renderBooks(snapshot);
                }, (error) => {
                    console.error("Error listening to books collection: ", error);
                    bookListDisplay.innerHTML = '<p class="text-red-500 text-center col-span-full">Error loading books. Please try again.</p>';
                    bookListLoading.classList.add('hidden');
                });

                // Real-time listener for problems
                onSnapshot(query(getCollectionRef("problems")), (snapshot) => { // Removed orderBy
                    renderProblems(snapshot);
                }, (error) => {
                    console.error("Error listening to problems collection: ", error);
                    problemsDisplay.innerHTML = '<p class="text-red-500 text-center col-span-full">Error loading problems. Please try again.</p>';
                    problemsLoading.classList.add('hidden');
                });

                // Real-time listener for gallery posts
                onSnapshot(query(getCollectionRef("gallery_posts")), (snapshot) => { // Removed orderBy
                    renderGallery(snapshot);
                }, (error) => {
                    console.error("Error listening to gallery collection: ", error);
                    galleryDisplay.innerHTML = '<p class="text-red-500 text-center col-span-full">Error loading gallery. Please try again.</p>';
                    galleryLoading.classList.add('hidden');
                });

                // Real-time listener for blog posts
                onSnapshot(query(getCollectionRef("blog_posts")), (snapshot) => { // Removed orderBy
                    renderBlogs(snapshot);
                }, (error) => {
                    console.error("Error listening to blog collection: ", error);
                    blogDisplay.innerHTML = '<p class="text-red-500 text-center col-span-full">Error loading blog posts. Please try again.</p>';
                    blogLoading.classList.add('hidden');
                });

            } else {
                console.warn("Firestore not initialized for real-time listeners.");
            }
        }

    </script>
</body>
</html>
